---
title: "Results"
author: "Jose"
date: "13/11/18"
output: pdf_document
bibliography: references.bib
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(vegan)
library(xtable)
library(kableExtra)
library(reshape2)
library(ape)
library(phytools)
library(plotrix)
library(dplyr)
#load environment
load("myEnvironment_mantel.RData")
```

To check for the effect of heterospecific pollen we assume that the optimal seed production is the hand cross pollination (pollinated with pollen from a different individual of the same species). Then, we substract to the mean value of hand cross pollination the mean value of heterospecific pollen effect across treatments (50% conspecific-50%heterospecific pollen). Previously we have scaled the seed set for each species with mean 0 and standard deviation of 1 to be able to compare among species. When a species had higher values of seed production with treatments than the cross, we set as maximum value for the treatments the same as the hand cross pollination. However, we should take into account that analysis in general improve if we keep these negative values. If we put these words into a formula being i the different focal species and j the different donors:

Eq.1  $$HpEffect_{i}=Mean(CrosPollinationSeeds_{i})-Mean(TreatmentSeeds_{ij})$$

So the higher the values HpEffect the higher the negative impact of heterospecific pollen.

The number of possible combinations with 10 species (multiplied by two because is in both directions the treatments A to B and B to A):

$$(\frac{10}{2})=\frac{10!}{2!*(8!)}*2=90 $$

In total we performed 4400 treatments. If we just consider seed set, 2200 treatments including [50% Hp, 100% Hp, hand cross pollination, self pollination, natural selfing (bagged flowers) and apomixis (emasculated flowers)].

#Part 1 Relation between effect of Hp and evolutive distance

I try Mantel test and procustes test, although both are similar procustes performs better in a wider range of circumstances @peres2001. Moreover, I consider the square root of the evolutive distances which improves the statistical power in comparison to the normal distances @letten2015.

1) With the RBCL marker

Heterospecific pollen effect~evolutive distance
```{r, echo=FALSE, message=FALSE}
mantel_rbcl <- mantel(matrix_scale_effect, evo_distance_rbcl)
mantel_rbcl_sqrt <- mantel(matrix_scale_effect, sqrt(evo_distance_rbcl))
pro_rbcl <- protest(matrix_scale_effect, evo_distance_rbcl, symmetric=F)
pro_rbcl_sqrt <- protest(matrix_scale_effect, sqrt(evo_distance_rbcl))


r <- c(as.numeric(mantel_rbcl[3]), as.numeric(mantel_rbcl_sqrt[3]),
       as.numeric(pro_rbcl[6]),as.numeric(pro_rbcl_sqrt[6]))
p <- c(as.numeric(mantel_rbcl[4]),as.numeric(mantel_rbcl_sqrt[4]),
       as.numeric(pro_rbcl[13]),as.numeric(pro_rbcl_sqrt[13]))
Analysis <- c("Mantel", "Mantel", "Procustes", "Procustes")
Type <- c("normal evolutive distance","sqrt evolutive distance","normal evolutive distance", "sqrt evolutive distance")
table<- data.frame(r,p, Analysis, Type)
kable(table, format="markdown")
```

I wonder if the matrices are too small for procustes, is a general trend for all the analysis to have a non significant p value and correlation around these numbers.

2) With the ITS marker

Heterospecific pollen effect~evolutive distance
```{r, echo=FALSE, message=FALSE}
mantel_its <- mantel(matrix_scale_effect, evo_distance_its)
mantel_its_sqrt <- mantel(matrix_scale_effect, sqrt(evo_distance_its))
pro_its <- protest(matrix_scale_effect, evo_distance_its)
pro_its_sqrt <- protest(matrix_scale_effect, sqrt(evo_distance_its))

r <- c(as.numeric(mantel_its[3]), as.numeric(mantel_its_sqrt[3]),
       as.numeric(pro_its[6]),as.numeric(pro_its_sqrt[6]))
p <- c(as.numeric(mantel_its[4]),as.numeric(mantel_its_sqrt[4]),
       as.numeric(pro_its[13]),as.numeric(pro_its_sqrt[13]))
Analysis <- c("Mantel", "Mantel", "Procustes", "Procustes")
Type <- c("normal evolutive distance","sqrt evolutive distance","normal evolutive distance", "sqrt evolutive distance")
table<- data.frame(r,p, Analysis, Type)
kable(table, format="markdown")
```

Overall, it seems that with phylogenetic distance, heterospecific pollen effect increases for the three families. From Mantel analysis we can conclude that we have a significant correlation between phylogenetic distance and heterospecific pollen effect with r values between 0.25 and 0.3. However, for procustes test we were not able to find a significant correlation between these two despite procustes correlation gave higher values. This positive correlation should be further explored. Maybe a scatterplot of the phylogenetic distance and the heterospecific pollen effect could help to understand this correlation.
```{r, echo=FALSE, message=FALSE, warning=FALSE}


plot(focal$hp_effect ~ focal$its_distance, main="", xlim=c(0.05,0.6),
     xlab="Evolutive distance", ylab="Hp effect", pch=19, col=focal$col_focal)

legend(x=0.04,y=3.2,legend=c("Brassicaceae","Convolvulaceae","Solanaceae"),pch=(c(16,16,16)), 
       col = c("red","black","blue"), bty="n",cex=0.6,pt.cex=0.6,xpd=TRUE)

```
Figure 1. Scatterplot of the evolutive distances (x axis) and the mean scaled effect per species (ITS markers). In other words, each point is defined by the phylogenetic distance between a pair of species (x axis) and the effect of heterospecifc pollen which considers also an interaction between the same pair of species (donor and recipient)(y axis)
\newpage

Although is not very elegant, I  had the curiosity of how a regression line will fit these 3 different families. Here I show how they fit the cloud of points per family *lm(HpEffect~its_distance)*. Anyway, don't think this is very informative.


```{r, echo=FALSE, message=FALSE, warning=FALSE}

plot(focal$hp_effect ~ focal$its_distance, main="", xlim=c(0.05,0.6),
     xlab="Evolutive distance", ylab="Hp effect", pch=19, col=focal$col_focal)

legend(x=0.04,y=3.2,legend=c("Brassicaceae","Convolvulaceae","Solanaceae"),pch=(c(16,16,16)), 
       col = c("red","black","blue"), bty="n",cex=0.6,pt.cex=0.6,xpd=TRUE)

model_bra <- lm(focal_bra$value ~ focal_bra$value.1)
#summary(model_brra)
abline(model_bra, col="red")
model_sol <- lm(focal_sol$value ~ focal_sol$value.1)
#summary(model_sol)
abline(model_sol, col="blue")
model_con <- lm(focal_con$value ~ focal_con$value.1)
#summary(model_con)
abline(model_con, col="black")

```


So far I think phylogenetic distance doesn't help to visualize heterospecific pollen effect. Grouping by traits or the type of donor seems to be much more informative.


\newpage

```{r, echo=FALSE, message=FALSE, warning=FALSE}
pollen_tree=read.tree("pollen_tree.nwk")
plot(pollen_tree)
add.scale.bar(x=0, y=1)
```

\newpage
#Part 2 Relation between effect of Hp and traits

Here I perform Mantel test and Procustes test between the traits and heterospecific pollen effect. For both Mantel and procustes we weren't able to find evidence of correlation between matrices. At the moment we are using all the traits without filtering the correlated traits. With Bioenv we can know what are the traits that gives a best fit of correlation between matrices. The best model is with pollen ovule ratio, stigma width and style width.

```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE}
load("bio_result.RData")
m_all <- mantel(matrix_scale_effect, traits_all_scaled_dist)
p_all <- protest(matrix_scale_effect, traits_all_scaled_dist)

r <- c(as.numeric(m_all[3]),as.numeric(p_all[6]), as.numeric(bio_result$`models`[[3]]$est))
p <- c(as.numeric(m_all[4]),as.numeric(p_all[13]), NA)
Analysis <- c("Mantel", "Procustes", "Bioenv")
table<- data.frame(r,p, Analysis)
kable(table, format="markdown")

```

Now I perform the analysis with both Mantel and Procustes trait by trait.

```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE}
a_1 <- mantel(matrix_scale_effect, traits_stigma_dist)
a_2 <- protest(matrix_scale_effect, traits_stigma_dist)
b_1 <- mantel(matrix_scale_effect, traits_self_dist)
b_2 <- protest(matrix_scale_effect, traits_self_dist)
c_1 <- mantel(matrix_scale_effect, pollen_size_dist)
c_2 <- protest(matrix_scale_effect, pollen_size_dist)
d_1 <- mantel(matrix_scale_effect, pollen_dist)
d_2 <- protest(matrix_scale_effect, pollen_dist)
e_1 <- mantel(matrix_scale_effect, ovules_dist)
e_2 <- protest(matrix_scale_effect, ovules_dist)
f_1 <- mantel(matrix_scale_effect, p_o_ratio_dist)
f_2 <- protest(matrix_scale_effect, p_o_ratio_dist)
g_1 <- mantel(matrix_scale_effect, anthers_dist)
g_2 <- protest(matrix_scale_effect, anthers_dist)
h_1 <- mantel(matrix_scale_effect, stigma_area_dist)
h_2 <- protest(matrix_scale_effect, stigma_area_dist)
i_1 <- mantel(matrix_scale_effect, stigma_length_dist)
i_2 <- protest(matrix_scale_effect, stigma_length_dist)
j_1 <- mantel(matrix_scale_effect, stigma_surface_dist)
j_2 <- protest(matrix_scale_effect, stigma_surface_dist)
k_1 <- mantel(matrix_scale_effect, stigma_width_dist)
k_2 <- protest(matrix_scale_effect, stigma_width_dist)
l_1 <- mantel(matrix_scale_effect, style_length_dist)
l_2 <- protest(matrix_scale_effect, style_length_dist)
m_1 <- mantel(matrix_scale_effect, style_width_dist)
m_2 <- protest(matrix_scale_effect, style_width_dist)
n_1 <- mantel(matrix_scale_effect, ovary_length_dist)
n_2 <- protest(matrix_scale_effect, ovary_length_dist)
o_1 <- mantel(matrix_scale_effect, ovary_width_dist)
o_2 <- protest(matrix_scale_effect, ovary_width_dist)

r <- c(as.numeric(a_1[3]),as.numeric(a_2[6]),as.numeric(b_1[3]),as.numeric(b_2[6]),as.numeric(c_1[3]),
       as.numeric(c_2[6]), as.numeric(d_1[3]), as.numeric(d_2[6]), as.numeric(e_1[3]), as.numeric(e_2[6]),
       as.numeric(f_1[3]), as.numeric(f_2[6]), as.numeric(g_1[3]), as.numeric(g_2[6]), as.numeric(h_1[3]), as.numeric(h_2[6]), as.numeric(i_1[3]), as.numeric(i_2[6]), as.numeric(j_1[3]), as.numeric(j_2[6]), as.numeric(k_1[3]), as.numeric(k_2[6]), as.numeric(l_1[3]), as.numeric(l_2[6]), as.numeric(m_1[3]), as.numeric(m_2[6]),as.numeric(n_1[3]), as.numeric(n_2[6]), as.numeric(o_1[3]), as.numeric(o_2[6]))

p <- c(as.numeric(a_1[4]),as.numeric(a_2[13]), as.numeric(b_1[4]),as.numeric(b_2[13]), as.numeric(c_1[4]),as.numeric(c_2[13]), as.numeric(d_1[4]),as.numeric(d_2[13]), as.numeric(e_1[4]),as.numeric(e_2[13]), as.numeric(f_1[4]),as.numeric(f_2[13]), as.numeric(g_1[4]),as.numeric(g_2[13]), as.numeric(h_1[4]),as.numeric(h_2[13]),  as.numeric(i_1[4]),as.numeric(i_2[13]),  as.numeric(j_1[4]),as.numeric(j_2[13]), as.numeric(k_1[4]),as.numeric(k_2[13]), as.numeric(l_1[4]),as.numeric(l_2[13]), as.numeric(m_1[4]),as.numeric(m_2[13]), as.numeric(n_1[4]),as.numeric(n_2[13]), as.numeric(o_1[4]),as.numeric(o_2[13]))

Analysis <- c("**Mantel**", "Procustes","Mantel", "Procustes", "Mantel", "Procustes", "Mantel", "Procustes", "Mantel", "Procustes", "Mantel", "Procustes", "Mantel", "Procustes", "**Mantel**", "Procustes", "Mantel", "Procustes", "**Mantel**", "Procustes","Mantel", "Procustes", "Mantel", "Procustes", "Mantel", "Procustes",
              "Mantel", "Procustes", "Mantel", "Procustes")
Trait<- c("**Stigma_type**", "Stigma_type", "Selfing_rate", "Selfing_rate", "Pollen size", "Pollen size", "Pollen_anther","Pollen_anther", "Ovules", "Ovules", "Pollen_ovule_ratio", "Pollen_ovule_ratio", "Anthers", 
          "Anthers", "**Stigma_area**", "Stigma_area", "Stigma_length", "Stigma_length", "**Stigma_surface**", "Stigma_surface", "Stigma_width", "Stigma_width", "Style_length", "Style_length", "Style_width", "Style_width", "Ovary_length", "Ovary_length", "Ovary_width", "Ovary_width")
table<- data.frame(r,p, Analysis, Trait)
kable(table, format="markdown")

```



#References