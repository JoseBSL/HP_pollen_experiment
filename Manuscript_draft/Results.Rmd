---
title: "Results"
author: "Jose"
date: "13/11/18"
output: pdf_document
bibliography: references.bib
editor_options: 
  chunk_output_type: inline
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(vegan)
library(xtable)
library(kableExtra)
library(reshape2)
library(ape)
library(phytools)
library(plotrix)
library(dplyr)
library(ggfortify)
library(ggplot2)
library(stats)
library(cluster)
library(MASS)
library(cowplot)
#load environment
load("myEnvironment_mantel.RData")
```

To check for the effect of heterospecific pollen we assume that the optimal seed production is the hand cross pollination (pollinated with pollen from a different individual of the same species). Then, we substract to the mean value of hand cross pollination the mean value of heterospecific pollen effect across treatments (50% conspecific-50%heterospecific pollen). Previously we have scaled the seed set for each species with mean 0 and standard deviation of 1 to be able to compare among species. When a species had higher values of seed production with treatments than the cross, we set as maximum value for the treatments the same as the hand cross pollination. However, we should consider that analysis in general improve if we keep these negative values. If we put these words into a formula being i the different focal species and j the different donors:

Eq.1  $$HpEffect_{i}=Mean(CrosPollinationSeeds_{i})-Mean(TreatmentSeeds_{ij})$$

Therefore, the higher the values of HpEffect the higher the impact of it.

#Part 1 Relation between effect of Hp and evolutive distance

I try **Mantel test** and procustes test, although both are similar procustes performs better in a wider range of circumstances @peres2001. Moreover, I consider the square root of the evolutive distances which improves the statistical power in comparison to the normal distances @letten2015.

1) With the RBCL marker

Heterospecific pollen effect~evolutive distance
```{r, echo=FALSE, message=FALSE}
mantel_rbcl <- mantel(matrix_scale_effect, evo_distance_rbcl)
mantel_rbcl_sqrt <- mantel(matrix_scale_effect, sqrt(evo_distance_rbcl))
pro_rbcl <- protest(matrix_scale_effect, evo_distance_rbcl, symmetric=F)
pro_rbcl_sqrt <- protest(matrix_scale_effect, sqrt(evo_distance_rbcl))


r <- c(as.numeric(mantel_rbcl[3]), as.numeric(mantel_rbcl_sqrt[3]),
       as.numeric(pro_rbcl[6]),as.numeric(pro_rbcl_sqrt[6]))
p <- c(as.numeric(mantel_rbcl[4]),as.numeric(mantel_rbcl_sqrt[4]),
       as.numeric(pro_rbcl[13]),as.numeric(pro_rbcl_sqrt[13]))
Analysis <- c("**Mantel**", "**Mantel**", "Procustes", "Procustes")
Type <- c("**normal evolutive distance**","**sqrt evolutive distance**","normal evolutive distance", "sqrt evolutive distance")
table<- data.frame(r,p, Analysis, Type)
kable(table, format="markdown")
```

I wonder if the matrices are too small for procustes, is a general trend for all the analysis to have a non significant p value and correlation around these numbers.

2) With the ITS marker

Heterospecific pollen effect~evolutive distance
```{r, echo=FALSE, message=FALSE}
mantel_its <- mantel(matrix_scale_effect, evo_distance_its)
mantel_its_sqrt <- mantel(matrix_scale_effect, sqrt(evo_distance_its))
pro_its <- protest(matrix_scale_effect, evo_distance_its)
pro_its_sqrt <- protest(matrix_scale_effect, sqrt(evo_distance_its))

r <- c(as.numeric(mantel_its[3]), as.numeric(mantel_its_sqrt[3]),
       as.numeric(pro_its[6]),as.numeric(pro_its_sqrt[6]))
p <- c(as.numeric(mantel_its[4]),as.numeric(mantel_its_sqrt[4]),
       as.numeric(pro_its[13]),as.numeric(pro_its_sqrt[13]))
Analysis <- c("**Mantel**", "**Mantel**", "Procustes", "Procustes")
Type <- c("**normal evolutive distance**","**sqrt evolutive distance**","normal evolutive distance", "sqrt evolutive distance")
table<- data.frame(r,p, Analysis, Type)
kable(table, format="markdown")
```

Overall, it seems that with phylogenetic distance, heterospecific pollen effect increases for the three families. From Mantel analysis we can conclude that we have a significant correlation between phylogenetic distance and heterospecific pollen effect with r values between 0.25 and 0.3. However, for procustes test we were not able to find a significant correlation between these two despite procustes correlation gave higher values. This positive correlation should be further explored.

#Part 2 Relation between effect of Hp and traits

Here I perform **Mantel test** and **Procustes test** between the matrices of traits and heterospecific pollen effect. For both Mantel and procustes we were not able to find evidence of correlation between matrices. At the moment we are using all the traits without filtering the correlated traits (similar result also if we not consider some rudendant traits). With **Bioenv** we can see what are the traits that gives a best fit of correlation between our matrix of Hp effect and the dataset of traits The best model with Bioenv is with pollen ovule ratio, stigma width and style width. For Mantel the stigma surface (width from aerial view) seems to be correlated with the Hp effect. Moreover, stigma type too but these values are converted to distance from ones and zeros and don not know how much it can be trusted.

```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE}
load("bio_result.RData")
m_all <- mantel(matrix_scale_effect, traits_all_scaled_dist)
p_all <- protest(matrix_scale_effect, traits_all_scaled_dist)

r <- c(as.numeric(m_all[3]),as.numeric(p_all[6]), as.numeric(bio_result$`models`[[3]]$est))
p <- c(as.numeric(m_all[4]),as.numeric(p_all[13]), NA)
Analysis <- c("Mantel", "Procustes", "Bioenv")
table<- data.frame(r,p, Analysis)
kable(table, format="markdown")

```

Now I perform the analysis with both **Mantel** and **Procustes** trait by trait.

```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE}
a_1 <- mantel(matrix_scale_effect, traits_stigma_dist)
a_2 <- protest(matrix_scale_effect, traits_stigma_dist)
b_1 <- mantel(matrix_scale_effect, traits_self_dist)
b_2 <- protest(matrix_scale_effect, traits_self_dist)
c_1 <- mantel(matrix_scale_effect, pollen_size_dist)
c_2 <- protest(matrix_scale_effect, pollen_size_dist)
d_1 <- mantel(matrix_scale_effect, pollen_dist)
d_2 <- protest(matrix_scale_effect, pollen_dist)
e_1 <- mantel(matrix_scale_effect, ovules_dist)
e_2 <- protest(matrix_scale_effect, ovules_dist)
f_1 <- mantel(matrix_scale_effect, p_o_ratio_dist)
f_2 <- protest(matrix_scale_effect, p_o_ratio_dist)
g_1 <- mantel(matrix_scale_effect, anthers_dist)
g_2 <- protest(matrix_scale_effect, anthers_dist)
h_1 <- mantel(matrix_scale_effect, stigma_area_dist)
h_2 <- protest(matrix_scale_effect, stigma_area_dist)
i_1 <- mantel(matrix_scale_effect, stigma_length_dist)
i_2 <- protest(matrix_scale_effect, stigma_length_dist)
j_1 <- mantel(matrix_scale_effect, stigma_surface_dist)
j_2 <- protest(matrix_scale_effect, stigma_surface_dist)
k_1 <- mantel(matrix_scale_effect, stigma_width_dist)
k_2 <- protest(matrix_scale_effect, stigma_width_dist)
l_1 <- mantel(matrix_scale_effect, style_length_dist)
l_2 <- protest(matrix_scale_effect, style_length_dist)
m_1 <- mantel(matrix_scale_effect, style_width_dist)
m_2 <- protest(matrix_scale_effect, style_width_dist)
n_1 <- mantel(matrix_scale_effect, ovary_length_dist)
n_2 <- protest(matrix_scale_effect, ovary_length_dist)
o_1 <- mantel(matrix_scale_effect, ovary_width_dist)
o_2 <- protest(matrix_scale_effect, ovary_width_dist)

r <- c(as.numeric(a_1[3]),as.numeric(a_2[6]),as.numeric(b_1[3]),as.numeric(b_2[6]),as.numeric(c_1[3]),
       as.numeric(c_2[6]), as.numeric(d_1[3]), as.numeric(d_2[6]), as.numeric(e_1[3]), as.numeric(e_2[6]),
       as.numeric(f_1[3]), as.numeric(f_2[6]), as.numeric(g_1[3]), as.numeric(g_2[6]), as.numeric(h_1[3]), as.numeric(h_2[6]), as.numeric(i_1[3]), as.numeric(i_2[6]), as.numeric(j_1[3]), as.numeric(j_2[6]), as.numeric(k_1[3]), as.numeric(k_2[6]), as.numeric(l_1[3]), as.numeric(l_2[6]), as.numeric(m_1[3]), as.numeric(m_2[6]),as.numeric(n_1[3]), as.numeric(n_2[6]), as.numeric(o_1[3]), as.numeric(o_2[6]))

p <- c(as.numeric(a_1[4]),as.numeric(a_2[13]), as.numeric(b_1[4]),as.numeric(b_2[13]), as.numeric(c_1[4]),as.numeric(c_2[13]), as.numeric(d_1[4]),as.numeric(d_2[13]), as.numeric(e_1[4]),as.numeric(e_2[13]), as.numeric(f_1[4]),as.numeric(f_2[13]), as.numeric(g_1[4]),as.numeric(g_2[13]), as.numeric(h_1[4]),as.numeric(h_2[13]),  as.numeric(i_1[4]),as.numeric(i_2[13]),  as.numeric(j_1[4]),as.numeric(j_2[13]), as.numeric(k_1[4]),as.numeric(k_2[13]), as.numeric(l_1[4]),as.numeric(l_2[13]), as.numeric(m_1[4]),as.numeric(m_2[13]), as.numeric(n_1[4]),as.numeric(n_2[13]), as.numeric(o_1[4]),as.numeric(o_2[13]))

Analysis <- c("**Mantel**", "Procustes","Mantel", "Procustes", "Mantel", "Procustes", "Mantel", "Procustes", "Mantel", "Procustes", "Mantel", "Procustes", "Mantel", "Procustes", "**Mantel**", "Procustes", "Mantel", "Procustes", "**Mantel**", "Procustes","Mantel", "Procustes", "Mantel", "Procustes", "Mantel", "Procustes",
              "Mantel", "Procustes", "Mantel", "Procustes")
Trait<- c("**Stigma_type**", "Stigma_type", "Selfing_rate", "Selfing_rate", "Pollen size", "Pollen size", "Pollen_anther","Pollen_anther", "Ovules", "Ovules", "Pollen_ovule_ratio", "Pollen_ovule_ratio", "Anthers", 
          "Anthers", "**Stigma_area**", "Stigma_area", "Stigma_length", "Stigma_length", "**Stigma_surface**", "Stigma_surface", "Stigma_width", "Stigma_width", "Style_length", "Style_length", "Style_width", "Style_width", "Ovary_length", "Ovary_length", "Ovary_width", "Ovary_width")
table<- data.frame(r,p, Analysis, Trait)
kable(table, format="markdown")

```

Now I show the correlations between the different morphological traits in order to clean the data. The correlation is performed between the mean values for each species, so N=10.


```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE}
load("Data/trait_corr.RData")

a_1 <- cor.test(stigma_area$um, stigma_length$um)
a_2 <- cor.test(stigma_area$um, stigma_surface$um)
a_3 <- cor.test(stigma_area$um, stigma_width$um)
a_4 <- cor.test(stigma_area$um, style_length$um)
a_5 <- cor.test(stigma_area$um, style_width$um)
a_6 <- cor.test(stigma_area$um, ovary_width$um)
a_7 <- cor.test(stigma_area$um, ovary_length$um)
b_1 <- cor.test(stigma_length$um, stigma_surface$um)
b_2 <- cor.test(stigma_length$um, stigma_width$um)
b_3 <- cor.test(stigma_length$um, style_length$um)
b_4 <- cor.test(stigma_length$um, style_width$um)
b_5 <- cor.test(stigma_length$um, ovary_width$um)
b_6 <- cor.test(stigma_length$um, ovary_length$um)
c_1 <- cor.test(stigma_surface$um, stigma_width$um)
c_2 <- cor.test(stigma_surface$um, style_length$um)
c_3 <- cor.test(stigma_surface$um, style_width$um)
c_4 <- cor.test(stigma_surface$um, ovary_width$um)
c_5 <- cor.test(stigma_surface$um, ovary_length$um)
d_1 <- cor.test(stigma_width$um, style_length$um)
d_2 <- cor.test(stigma_width$um, style_width$um)
d_3 <- cor.test(stigma_width$um, ovary_width$um)
d_4 <- cor.test(stigma_width$um, ovary_length$um)
e_1 <- cor.test(style_length$um, style_width$um)
e_2 <- cor.test(style_length$um, ovary_width$um)
e_3 <- cor.test(style_length$um, ovary_length$um)
f_1 <- cor.test(style_width$um, ovary_width$um)
f_2 <- cor.test(style_width$um, ovary_length$um)
g_1 <- cor.test(ovary_width$um, ovary_length$um)

r <- c(a_1[4],a_2[4],a_3[4],a_4[4],a_5[4],a_6[4],a_7[4], b_1[4],b_2[4],b_3[4],b_4[4],b_5[4],b_6[4], c_1[4],c_2[4],c_3[4],c_4[4],c_5[4], d_1[4],d_2[4],d_3[4],d_4[4], e_1[4],e_2[4],e_3[4], f_1[4],f_2[4], g_1[4])
r<- as.numeric(r)
p <- c(a_1[3],a_2[3],a_3[3],a_4[3],a_5[3],a_6[3],a_7[3], b_1[3],b_2[3],b_3[3],b_4[3],b_5[3],b_6[3], c_1[3],c_2[3],c_3[3],c_4[3],c_5[3], d_1[3],d_2[3],d_3[3],d_4[3], e_1[3],e_2[3],e_3[3], f_1[3],f_2[3], g_1[3])
p<-as.numeric(p)
corr_a<- c("Stigma_area~Stigma_length","**Stigma_area~Stigma_surface**","Stigma_area~Stigma_width","**Stigma_area~Style_length**","Stigma_area~Style_width","Stigma_area~Ovary_width","Stigma_area~Ovary_length")
corr_b <- c("Stigma_length~Stigma_surface","Stigma_length~Stigma_width","Stigma_length~Style_length","Stigma_length~Style_width","**Stigma_length~Ovary_width**","Stigma_length~Ovary_length")
corr_c <- c("stigma_surface~Stigma_width","**stigma_surface~Style_length**","stigma_surface~Style_width","stigma_surface~Ovary_width","stigma_surface~Ovary_length")
corr_d <- c("Stigma_width~Style_length","Stigma_width~Style_width","Stigma_width~Ovary_width","Stigma_width~Ovary_length")
corr_e <- c("Style_length~Style_width","Style_length~Ovary_width","Style_length~Ovary_length")
corr_f <- c("Style_width~Ovary_width","Style_width~Ovary_length")
corr_g <- c("Ovary_width~Ovary_length")
corr <- c(corr_a,corr_b,corr_c,corr_d,corr_e,corr_f,corr_g)

table<- data.frame(r,p, corr)
kable(table, format="markdown")

```

As it was expected, stigma area (square micrometers) and and stigma surface are highly correlated. Basically, they are the same measure. They are two different ways to estimate stigma size. 

\newpage
Multivariate homogeinity of groups dispersions (variances). Non-euclidean distances are handle by reducing the original distances to principal coordinates. Here I present an analysis of the variances for the measurements of Gynoecium for the ten species. The measurements used are width and length of stigma, style and ovary. Outliers were substituted by other values from the same variable and species. Didn't know how to perform it with NA's.

```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE}
load("betadisper.RData")
plot(traits, cex=1,pch=10:21,
     main="Gynoecium:MDS coordinates", cex.lab=1.25,label.cex=0.5,
     xlab=labs[1], ylab=labs[2], ylim=c(-0.35,0.35),xlim=c(-0.35,0.35),
     hull=FALSE, ellipse=TRUE, conf=0.68, lwd=2)

```

\newpage
Other way of showing the same results but now with Principal Components Analysis. Maybe is more elegant? Grouped by species.

```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE}
load("betadisper.RData")
autoplot(prcomp(all_pca), data = traits_all, colour = 'species', frame = TRUE, frame.type = 'norm')
```

\newpage
Now I group by family

```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE}
load("betadisper.RData")
autoplot(prcomp(all_pca), data = traits_all, colour = 'family', frame = TRUE, frame.type = 'norm', main="Gynoecium spp PCA")
```

\newpage
Now I use non metric multidimensional scaling for all the traits of our species. The traits used are: Stigma_type, Selfing_rate, Pollen_size, Mean_pollen_anther, Mean_ovules, Pollen_ovule_ratio, Anthers, Stigma_length, Stigma_surface (width), Style_length, Style_width, Ovary_width, Ovary_length


```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, cache.comments=FALSE,results='hide',fig.keep='all'}
all <- read.csv("Data/traits_all.csv", sep=",")
rownames(all) <- c("BROL","BRRA","CAAN","ERSA","IPAQ","IPPU","PEIN","SIAL","SOLY","SOME")
all <- all[,-c(1,2,10,13)]
all_scaled <- scale(all)
all_scaled_dist <- dist(all_scaled)
autoplot(sammon(all_scaled_dist), shape = FALSE, main="Non-metric multidimensional scaling",label.colour = 'blue', label.size = 3)
```


\newpage
Other type of NMDS

```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, cache.comments=FALSE, results='hide'}
all <- read.csv("Data/traits_all.csv", sep=",")
rownames(all) <- c("BROL","BRRA","CAAN","ERSA","IPAQ","IPPU","PEIN","SIAL","SOLY","SOME")
spp=c("BROL","BRRA","CAAN","ERSA","IPAQ","IPPU","PEIN","SIAL","SOLY","SOME")
all <- all[,-c(1,2,10,13)]
#In this case we consider all the traits. 
NMDS=metaMDS(all,k=2,trymax=100)
ordiplot(NMDS,type="n")
orditorp(NMDS,display="sites",col=c(rep("green",2),"blue","green", rep("black",2),"blue","green", rep("blue",2)),
         air=0.01,cex=1.25)
```

\newpage

Now I try to show the results of heterospecific pollen effect in a easy way to understand the pattern of seed set across treatments. For that I do 3 different scatterplots by family and then I colour the different spp. Note that the points should be all in the same vertical line because just Y axis is numerical but for representation purposes they are spread randomly across the x axis. I have added in the legend the selfing rates, in my opinion could be a bit informative to understand the different patterns. For Brassicaceae the percentage of fruiting is considered and for Solanaceae and Convolvulaceae the percentage of decrease of seed set in comparison with optimum pollination (seed set of hand cross poll.) is taken into account.

 What I see:
 
Interestignly for Brassicaceae species selfing rates matches pretty well the output of heterospecific pollen effect for 3 of 4 species. Therefore, it seems that selfing rates in Brassicaceae species could be a good predictor of foreign pollen effect. Another thing that I would like to remark is the *similar behaviour of each individual species irrespective of the donor*. This is a constant pattern for all our species of the different 3 families (other 2 families below). I think it is a very interesting finding that each species despite some variation maintains normally a similar response independently of the nature of the donor. *Moreover, the effect is high or low irrespective of the family but more or less constant within spp*.



```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE}
load("Data/all_bra.Rda")
cbPalette <- c("#000000", "#E69F00", "darkturquoise", "deeppink3")
 ggplot(all_bra, aes(x=close_related, y=hp_effect)) + 
  geom_jitter(width=0.1,aes(colour = Pollen_recipient),size=3.5)+
  theme_cowplot()+theme(axis.title.x=element_blank(),
axis.text.x=element_blank(),axis.ticks.x=element_blank(),legend.position = c(0.6, 0.8))+
  scale_x_continuous(limits = c(0.8, 1.35)) +scale_y_continuous("Heterospecific pollen effect")+
   annotate("text", x = c(0.82,0.82), y=c(0.4,2.2), label = c("Low effect","High effect"))+
   geom_hline(yintercept = 1.5)+scale_color_manual(values = cbPalette)+labs(title = "Brassicaceae spp", subtitle = "")
```
Figure X. Heterospecific pollen effect of the different species of the Brassicaceae family. Each point correspond to the scaled seed set for the different treatments (9 for each spp). Random dispersion was applied to the points to avoid overlapping (jitter). The line, is an arbitrary line that I added in the half of the plot (approx) to try to improve visualization.


\newpage

Again species with highest selfing has lowest Hp effect.

```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE}
load("Data/all_sol.Rda")
cbPalette <- c("#000000", "#E69F00", "darkturquoise", "deeppink3")
 
 ggplot(all_sol, aes(x=close_related, y=hp_effect)) + 
   geom_jitter(width=0.1,aes(colour = Pollen_recipient),size=4)+
   theme_cowplot()+theme(axis.title.x=element_blank(),
                         axis.text.x=element_blank(),axis.ticks.x=element_blank(),legend.position = c(0.6, 0.8))+
   scale_x_continuous(limits = c(0.8, 1.35)) +scale_y_continuous("Heterospecific pollen effect")+
   annotate("text", x = c(0.82,0.82), y=c(0.4,2.2), label = c("Low effect","High effect"))+
   geom_hline(yintercept = 1.5)+scale_color_manual(values = cbPalette)+labs(title = "Solanaceae spp", subtitle = "")
 
 
```
Figure X. Heterospecific pollen effect on the different species of the Solanaceae family. Random dispersion was applied to the points to avoid overlapping (jitter).

\newpage

Same, species with highest selfing has lowest Hp effect.

```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE}
load("Data/all_con.Rda")
cbPalette <- c("#000000", "#E69F00", "darkturquoise", "deeppink3")
 
ggplot(all_con, aes(x=close_related, y=hp_effect)) + 
   geom_jitter(width=0.1,aes(colour = Pollen_recipient),size=4)+
   theme_cowplot()+theme(axis.title.x=element_blank(),
                         axis.text.x=element_blank(),axis.ticks.x=element_blank(),legend.position = c(0.6, 0.92))+
   scale_x_continuous(limits = c(0.8, 1.35)) +scale_y_continuous("Heterospecific pollen effect")+
   annotate("text", x = c(0.82,0.82), y=c(0.4,2.2), label = c("Low effect","High effect"))+
   geom_hline(yintercept = 1.5)+scale_color_manual(values = cbPalette)+labs(title = "Solanaceae spp", subtitle = "")
 
 
 
```
Figure X. Heterospecific pollen effect on the different species of the Convolvulaceae family. Random dispersion was applied to the points to avoid overlapping (jitter).




\newpage

Phylogenetic signal of traits

The variables with highes values of Pagel's lambda are *selfing rate*, *pollen size*, *stigma surface* and *stigma width*. How to interpretate high values and no significance?

```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE}
load("Data/phylo_sign.RData")

lambda <- c(stigma_type[1], selfing[1], pollen_size[1], mean_pollen_anther[1], mean_ovules[1], pollen_ovule_ratio[1], stigma_area[1], stigma_length[1], stigma_surface[1], stigma_width[1], style_length[1], style_width[1], ovary_length[1], ovary_width[1], si_index[1])
lambda<- as.numeric(lambda)
p <- c(stigma_type[4], selfing[4], pollen_size[4], mean_pollen_anther[4], mean_ovules[4], pollen_ovule_ratio[4], stigma_area[4], stigma_length[4], stigma_surface[4], stigma_width[4], style_length[4], style_width[4], ovary_length[4], ovary_width[4],si_index[4])
p <- as.numeric(p)
trait <- c("stigma_type","**selfing_rate**", "**pollen_size**", "mean_pollen_anther", "mean_ovules", "pollen_ovule_ratio", "stigma_area", "stigma_length", "**stigma_surface**", "**stigma_width**", "style_length", "style_width", "ovary_length",
           "ovary_width")
table<- data.frame(lambda,p, trait)
colnames(table) <- c("Lambda", "P-value", "Traits")
kable(table, format="markdown")
```

#References