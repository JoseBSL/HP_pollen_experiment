---
title: "Data_visualization"
output:
      pdf_document
---

```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=3.8}
#load libraries

library(ggplot2)
library(colorspace)
library(gridExtra)

colours <- rainbow_hcl(4, start = 30, end = 300)
#load data

par(mfrow=c(2,1))
d<-read.csv("Data/Ovules.csv", sep=";")
d<- d[,-c(9,11)]
colnames(d)[1]<-"C. annuum"
colnames(d)[2]<-"S. lycopersicum"
colnames(d)[3]<-"S. melongera"
colnames(d)[4]<-"P. integrifolia"
colnames(d)[5]<-"B. oleracea"
colnames(d)[6]<-"B. rapa"
colnames(d)[7]<-"E. sativa"
colnames(d)[8]<-"S. alba"
colnames(d)[9]<-"I. aquatica"
colnames(d)[10]<-"I. purpurea"


#Reorganise data
d <- stack(d)
#Naming columns
colnames(d)[1]<-"ovules"
colnames(d)[2]<-"species"

family<- c(rep("solanaceae",60),rep("brassicaceae",60),rep("convolvulaceae",30))

d[,"family"] <- family




#subset per family (solanaceae, brassicaceae, convolvulaceae)
solanaceae<-subset(d)[1:60,]
brassicaceae<-subset(d)[61:120,]

# OVULES SOLANACEAE
p <- ggplot(solanaceae, aes(x = reorder(species, ovules, FUN = median), y = ovules)) +   geom_boxplot()+
labs(title="Solanaceae",x="", y = "Ovules")+aes(fill=species)+scale_fill_manual(values=colours)+
theme(plot.title = element_text(hjust = 0.5))

p + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none") 


# OVULES BRASSICACEAE
p <- ggplot(brassicaceae, aes(x = reorder(species, ovules, FUN = median), y = ovules)) +   geom_boxplot()+
labs(title="Brassicaceae",x="", y = "Ovules")+aes(fill=species)+scale_fill_manual(values=colours)+
theme(plot.title = element_text(hjust = 0.5))

p + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none") 

#all species
#formating d, to have just the spp of interest



p <- ggplot(d, aes(x = reorder(species, ovules, FUN = median), y = ovules)) +   geom_boxplot()+
labs(title="Ovules per spp.",x="", y = "Ovules")+aes(fill=family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
theme(plot.title = element_text(hjust = 0.5))

p + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none")

```


#Pollen per anther, just one Convolvulaceae at the moment
```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=3}
library(ggplot2)


p <- read.csv("data/Pollen.csv", sep = ";")

#Deleting extra row (21)
p <-p[-21,]

#boxplot(p)
#Reorganize data for ggplot
p<-stack(p)
#colnames
colnames(p)[1]<-"pollen"
colnames(p)[2]<-"species"

all<-p
solanaceae<-subset(p)[1:100,]
brassicaceae<- subset(p)[101:180,]

#Solanaceae
p <- ggplot(solanaceae, aes(x = reorder(species, pollen, FUN = median), y = pollen)) +   geom_boxplot()+
labs(title="Solanaceae",x="", y = "pollen")+aes(fill=species)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
theme(plot.title = element_text(hjust = 0.5))

p + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none")

#Brassicaceae
p <- ggplot(brassicaceae, aes(x = reorder(species, pollen, FUN = median), y = pollen)) +   geom_boxplot()+
labs(title="Brassicaceae",x="", y = "pollen")+aes(fill=species)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
theme(plot.title = element_text(hjust = 0.5))

p + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none")


#all
p <- ggplot(all, aes(x = reorder(species, pollen, FUN = median), y = pollen)) +   geom_boxplot()+
labs(title="All species",x="", y = "pollen")+aes(fill=species)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
theme(plot.title = element_text(hjust = 0.5))

p + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none")
```

```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=6}
tab <- read.csv("Data/tab.csv", sep="", header = T)

p <- ggplot(data=tab, aes(x=reorder(species, pollen_ovule_ratio, colour = cut), y=pollen_ovule_ratio))+aes(fill=family)+
  geom_bar(stat="identity", width=0.5)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  scale_fill_manual(values=colours)
p + ggtitle("Pollen/ovule ratio per species") + theme(plot.title = element_text(hjust = 0.5))+ labs(x = "Species")


```



```{r echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('Images/all_species.png')
```

\newpage
```{r,echo=FALSE, message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=6, fig.width=8,out.width='100%'}
par(mfrow=c(2,2))
#load libraries
library(reshape2)
library(ggplot2)
#read data
pein_seed_set <- read.csv("Data/PEIN_seed_set.csv", sep=";")
pein_seed_set <- pein_seed_set[-c(42,47,49),]

mean_seed_seet <- dcast(Treatment ~ ., value.var = "Seed.production", fun.aggregate = mean, data = pein_seed_set, na.rm= TRUE)

colnames(mean_seed_seet)[2] <-"avg"

sd_seed_seet <- dcast(Treatment ~ ., value.var = "Seed.production", fun.aggregate = sd, data = pein_seed_set, na.rm= TRUE)

colnames(sd_seed_seet)[2] <-"sdev"



#Unify mean and sd with merge
mean_sd <- merge(mean_seed_seet,sd_seed_seet, by="Treatment")
#Removing RARA, species not considered because sterility 
mean_sd<- mean_sd[-c(16,17),]

merge_1 <- data.frame(mean_sd, stringsAsFactors = F)
  
merge_1$Treatment<- as.character(merge_1$Treatment)
pein <- c("PEIN", NA, NA)

str(merge_1)
mean_sd_1 <- rbind(merge_1,pein)

#Order from lower to higher values the average, to plot it nicely
mean_sd_ordered <- mean_sd[order(mean_sd$avg),]  



mean_sd_ordered_alphabetically<- mean_sd_ordered[order(mean_sd_ordered$Treatment),]

#ploting averages with sd
x <- 1:22
plot(x, mean_sd_ordered$avg,
     ylim=range(c(mean_sd_ordered$avg-mean_sd_ordered$sdev, mean_sd_ordered$avg+mean_sd_ordered$sdev)),
     pch=19, xlab="", xaxt='n', ylab="Mean +/- SD",
     main="Petunia integrifolia")
# add arrows
arrows(x, mean_sd_ordered$avg-mean_sd_ordered$sdev, x, mean_sd_ordered$avg+mean_sd_ordered$sdev, length=0.05, angle=90, code=3)
lablist.x<-as.vector(mean_sd_ordered$Treatment)
axis(x, at=1:22, labels = FALSE)
text(x, par("usr")[3] - 0.2, labels = lablist.x, cex= 0.6, adj = 1.25,srt = 45, xpd = TRUE)

some_seed_set <- read.csv("Data/SOME_seed_set.csv", sep=";")
mean_seed_seet_some <- dcast(Treatment ~ ., value.var = "seed_set", fun.aggregate = mean, data = some_seed_set, na.rm= TRUE)
colnames(mean_seed_seet_some)[2] <-"avg"
sd_seed_seet_some <- dcast(Treatment ~ ., value.var = "seed_set", fun.aggregate = sd, data = some_seed_set, na.rm= TRUE)
colnames(sd_seed_seet_some)[2] <-"sdev"

#Unify mean and sd with merge
mean_sd_some <- merge(mean_seed_seet_some,sd_seed_seet_some, by="Treatment")
#Delete RARA rows, species not included because sterility
mean_sd_some <- mean_sd_some[-c(8,9,20),]

#Order from lower to higher values the average, to plot it nicely
mean_sd_ordered_some <- mean_sd_some[order(mean_sd_some$avg),] 

x <- 1:22
plot(x, mean_sd_ordered_some$avg,
     ylim=range(c(mean_sd_ordered_some$avg-mean_sd_ordered_some$sdev, mean_sd_ordered_some$avg+mean_sd_ordered_some$sdev)),
     pch=19, xlab="", xaxt='n', ylab="Mean +/- SD",
     main="Solanum melongena")
# add arrows
arrows(x, mean_sd_ordered_some$avg-mean_sd_ordered_some$sdev, x, mean_sd_ordered_some$avg+mean_sd_ordered_some$sdev, length=0.05, angle=90, code=3)
lablist.x<-as.vector(mean_sd_ordered_some$Treatment)
axis(x, at=1:22, labels = FALSE)
text(x, par("usr")[3] - 0.2, labels = lablist.x,  cex= 0.6, adj = 1.25,srt = 45, xpd = TRUE)

caan_seed_set <- read.csv("Data/CAAN_seed_set.csv", sep=";")
mean_seed_seet_caan <- dcast(treatment ~ ., value.var = "seed_set", fun.aggregate = mean, data = caan_seed_set, na.rm= TRUE)
colnames(mean_seed_seet_caan)[2] <-"avg"
sd_seed_seet_caan <- dcast(treatment ~ ., value.var = "seed_set", fun.aggregate = sd, data = caan_seed_set, na.rm= TRUE)
colnames(sd_seed_seet_caan)[2] <-"sdev"

#Unify mean and sd with merge
mean_sd_caan <- merge(mean_seed_seet_caan,sd_seed_seet_caan, by="treatment")
#Order from lower to higher values the average, to plot it nicely
mean_sd_ordered_caan <- mean_sd_caan[order(mean_sd_caan$avg),] 

x <- 1:22
plot(x, mean_sd_ordered_caan$avg,
     ylim=range(c(mean_sd_ordered_caan$avg-mean_sd_ordered_caan$sdev, mean_sd_ordered_caan$avg+mean_sd_ordered_caan$sdev)),
     pch=19, xlab="", xaxt='n', ylab="Mean +/- SD",
     main="Capsicum annuum")
# add arrows
arrows(x, mean_sd_ordered_caan$avg-mean_sd_ordered_caan$sdev, x, mean_sd_ordered_caan$avg+mean_sd_ordered_caan$sdev, length=0.05, angle=90, code=3)
lablist.x<-as.vector(mean_sd_ordered_caan$treatment)
axis(x, at=1:22, labels = FALSE)
text(x, par("usr")[3] - 0.2, labels = lablist.x,  cex= 0.6, adj = 1.25,srt = 45, xpd = TRUE)

soly_seed_set <- read.csv("Data/SOLY_seed_set.csv", sep=";")
mean_seed_seet_soly <- dcast(Treatment ~ ., value.var = "seed_set", fun.aggregate = mean, data = soly_seed_set, na.rm= TRUE)
colnames(mean_seed_seet_soly)[2] <-"avg"
sd_seed_seet_soly <- dcast(Treatment ~ ., value.var = "seed_set", fun.aggregate = sd, data = soly_seed_set, na.rm= TRUE)
colnames(sd_seed_seet_soly)[2] <-"sdev"

#Unify mean and sd with merge
mean_sd_soly <- merge(mean_seed_seet_soly,sd_seed_seet_soly, by="Treatment")
#Order from lower to higher values the average, to plot it nicely
mean_sd_ordered_soly <- mean_sd_soly[order(mean_sd_soly$avg),] 

x <- 1:26
plot(x, mean_sd_ordered_soly$avg,
     ylim=range(c(mean_sd_ordered_soly$avg-mean_sd_ordered_soly$sdev, mean_sd_ordered_soly$avg+mean_sd_ordered_soly$sdev)),
     pch=19, xlab="", xaxt='n', ylab="Mean +/- SD",
     main="Solanum lycopersicum")
# add arrows
arrows(x, mean_sd_ordered_soly$avg-mean_sd_ordered_soly$sdev, x, mean_sd_ordered_soly$avg+mean_sd_ordered_soly$sdev, length=0.05, angle=90, code=3)
lablist.x<-as.vector(mean_sd_ordered_soly$Treatment)
axis(x, at=1:26, labels = FALSE)
text(x, par("usr")[3] - 0.2, labels = lablist.x, cex= 0.6, adj = 1.25,srt = 45, xpd = TRUE)

```

\newpage
```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=3.5, fig.width=5,fig.show='asis',fig.align='center',out.width='70%'}
#Preparing seed set plots, starting with Petunia

#There are 3 crosses were seeds were lost (2,7,9)
#load libraries
library(reshape2)
library(ggplot2)
library(dplyr)
library(ggplot2)
library(grid)
library(gridExtra)
library(egg)
library(gtable)


#read data and cleaning
pein_seed_set <- read.csv("Data/PEIN_seed_set.csv", sep=";")
pein_seed_set <- pein_seed_set[-c(42,47,49),]

#
##
###
#PETUNIA
###
##
#


#Removing RARA, species not considered because sterility 

pein_seed_set <- filter(pein_seed_set, Treatment!="RARA 100%" & Treatment!="RARA 50%")

#adding the focal species, first 50%
Species <- rep("PEIN", 10)
Treatment <- rep("PEIN 50%", 10)
Treatment.number <- seq(1:10)
Seed.production <- rep(0, 10)
pein_50 <- data.frame(Species,Treatment, Treatment.number, Seed.production,stringsAsFactors = F)
#adding the focal species, 100%
Species <- rep("PEIN", 10)
Treatment <- rep("PEIN 100%", 10)
Treatment.number <- seq(1:10)
Seed.production <- rep(0, 10)
pein_100<-  data.frame(Species,Treatment, Treatment.number, Seed.production,stringsAsFactors = F)
#Order from lower to higher values the average, to plot it nicely
pein_seed_set <- rbind(pein_seed_set, pein_50, pein_100)
pein_seed_set$Treatment<- as.character(pein_seed_set$Treatment)
pein_seed_set <- pein_seed_set[order(pein_seed_set$Treatment),]  



plot1 <- ggplot(pein_seed_set, aes(x = Treatment, y = Seed.production)) +   geom_boxplot()+
  labs(title="Petunia integrifolia",x="", y = "Seeds")+aes(fill=Treatment)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5))

plot1 + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none")

#
##
###
#S. MELONGENA
###
##
#

#Taking out species that weren't used
some_seed_set <- read.csv("Data/SOME_seed_set.csv", sep=";")
some_seed_set <- filter(some_seed_set, Treatment!="RARA 100%" & Treatment!="RARA 50%" & Treatment!="COSA 50%" & Treatment!="COSA 100%")

#adding the focal species, first 50%
Species <- rep("SOME", 10)
Treatment <- rep("SOME 50%", 10)
Treatment.number <- seq(1:10)
Seed.production <- rep(0, 10)
some_50 <- data.frame(Species,Treatment, Treatment.number, Seed.production)
#adding the focal species, 100%
Species <- rep("SOME", 10)
Treatment <- rep("SOME 100%", 10)
Treatment.number <- seq(1:10)
Seed.production <- rep(0, 10)
some_100<-  data.frame(Species,Treatment, Treatment.number, Seed.production)
#Order from lower to higher values the average, to plot it nicely
some_seed_set<- some_seed_set[,-3]
colnames(some_seed_set)[3] <- "Treatment.number"
colnames(some_seed_set)[4] <- "Seed.production"
some_seed_set <- rbind(some_seed_set, some_50, some_100)
some_seed_set$Treatment<- as.character(some_seed_set$Treatment)
some_seed_set <- some_seed_set[order(some_seed_set$Treatment),]  


plot2 <- ggplot(some_seed_set, aes(x = Treatment, y = Seed.production)) +   geom_boxplot()+
  labs(title="Solanum melongena",x="", y = "Seeds")+aes(fill=Treatment)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5))

plot2 + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none")


#
##
###
#C. ANNUUM 
###
##
#
caan_seed_set <- read.csv("Data/CAAN_seed_set.csv", sep=";")

#adding the focal species, first 50%
Species <- rep("CAAN", 10)
Treatment <- rep("CAAN 50%", 10)
Treatment.number <- seq(1:10)
Seed.production <- rep(0, 10)
caan_50 <- data.frame(Species,Treatment, Treatment.number, Seed.production)
#adding the focal species, 100%
Species <- rep("CAAN", 10)
Treatment <- rep("CAAN 100%", 10)
Treatment.number <- seq(1:10)
Seed.production <- rep(0, 10)
caan_100<-  data.frame(Species,Treatment, Treatment.number, Seed.production)
#Order from lower to higher values the average, to plot it nicely
caan_seed_set <- caan_seed_set[,-4]
colnames(caan_seed_set)[1] <- "Species"
colnames(caan_seed_set)[2] <- "Treatment"
colnames(caan_seed_set)[3] <- "Treatment.number"
colnames(caan_seed_set)[4] <- "Seed.production"
caan_seed_set <- rbind(caan_seed_set, caan_50, caan_100)
caan_seed_set$Treatment<- as.character(caan_seed_set$Treatment)
caan_seed_set <- caan_seed_set[order(caan_seed_set$Treatment),]  


plot3 <- ggplot(caan_seed_set, aes(x = Treatment, y = Seed.production)) +   geom_boxplot()+
  labs(title="Capsicum annuum",x="", y = "Seeds")+aes(fill=Treatment)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5))

plot3 + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none")

#
##
###
#S. LYCOPERSICUM
###
##
#


soly_seed_set <- read.csv("Data/SOLY_seed_set.csv", sep=";")
soly_seed_set <- filter(soly_seed_set, Treatment!="RARA 100%" & Treatment!="RARA 50%"& Treatment!="COSA 50%"& Treatment!="COSA 100%" )

#adding the focal species, first 50%
Species <- rep("SOLY", 10)
Treatment <- rep("SOLY 50%", 10)
Treatment.number <- seq(1:10)
Seed.production <- rep(0, 10)
soly_50 <- data.frame(Species,Treatment, Treatment.number, Seed.production)
#adding the focal species, 100%
Species <- rep("SOLY", 10)
Treatment <- rep("SOLY 100%", 10)
Treatment.number <- seq(1:10)
Seed.production <- rep(0, 10)
soly_100<-  data.frame(Species,Treatment, Treatment.number, Seed.production)
#Order from lower to higher values the average, to plot it nicely
soly_seed_set <- soly_seed_set[,-4]
colnames(soly_seed_set)[1] <- "Species"
colnames(soly_seed_set)[2] <- "Treatment"
colnames(soly_seed_set)[3] <- "Treatment.number"
colnames(soly_seed_set)[4] <- "Seed.production"
soly_seed_set <- rbind(soly_seed_set, soly_50, soly_100)
soly_seed_set$Treatment<- as.character(soly_seed_set$Treatment)
soly_seed_set <- soly_seed_set[order(soly_seed_set$Treatment),]  


plot4 <- ggplot(soly_seed_set, aes(x = Treatment, y = Seed.production)) +   geom_boxplot()+
  labs(title="Solanum lycopersicum",x="", y = "Seeds")+aes(fill=Treatment)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5))

plot4 + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none") 

```

