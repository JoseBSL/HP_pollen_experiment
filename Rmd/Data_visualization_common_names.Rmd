---
title: "Data_visualization"
output:
      pdf_document
---

###SEED SET PER SPECIES WITH DIFFERENT TREATMENTS
```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=6, fig.width=7,out.width='100%'}
#Preparing seed set plots, starting with Petunia

#There are 3 crosses were seeds were lost (2,7,9)
#load libraries
library(reshape2)
library(ggplot2)
library(dplyr)
library(gridExtra)
library(grid)
library(lattice)
#read data and cleaning
pein_seed_set_final <- read.csv("Data/pein_seed_set_final_common_names.csv")
pein_seed_set_final=pein_seed_set_final[,-1]
#load the palette for all the 4 plots
cbPalette <- c( "#56B4E9","#E69F00", "#999999", "#009E73")
#Colur per family

a <- ggplot(pein_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Petunia",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x =element_blank())+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")



#
##
###
#C. ANNUUM 
###
##
#
caan_seed_set_final <- read.csv("Data/caan_seed_set_final.csv")
caan_seed_set_final=caan_seed_set_final[,-1]


#Colur per family
#Different colour per family
b <- ggplot(caan_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Capsicum",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x =element_blank())+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")



#
##
###
#S. LYCOPERSICUM
###
##
#


soly_seed_set_final <- read.csv("Data/soly_seed_set_final_common_names.csv")
soly_seed_set_final=soly_seed_set_final[,-1]

cbPalette <- c( "#56B4E9","#E69F00", "#999999", "#009E73")
#Different colour per family
c <- ggplot(soly_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Tomato",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")


#
##
###
#S. MELONGENA
###
##
#


some_seed_set_final <- read.csv("Data/some_seed_set_final_common_names.csv")
some_seed_set_final=some_seed_set_final[,-1]


#Different colour per family
d <- ggplot(some_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Eggplant",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")



gl <- lapply(list(a,b,c,d), ggplotGrob)
library(grid)
widths <- do.call(unit.pmax, lapply(gl, "[[", "widths"))
heights <- do.call(unit.pmax, lapply(gl, "[[", "heights"))
lg <- lapply(gl, function(g) {g$widths <- widths; g$heights <- heights; g})



grobz <- lapply(list(a, b, c, d), ggplotGrob)
grobz.plot <- arrangeGrob( grobs = list(rbind(grobz[[1]], grobz[[3]], size = "last"),
                                        rbind(grobz[[2]], grobz[[4]], size = "last")),
                           ncol = 2, top="Solanaceae Focal Species")

grid.draw(grobz.plot)

```


```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=6, fig.width=7,out.width='100%'}
library(dplyr)

#load libraries
library(reshape2)
library(ggplot2)
library(dplyr)
library(gridExtra)
library(grid)
library(lattice)
library(gtable)
##
###
#B. OLERACEA
###
##
#

brol_seed_set_final <- read.csv("Data/brol_seed_set_final.csv")
brol_seed_set_final=brol_seed_set_final[,-1]
#Different colour per family
a <- ggplot(brol_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Wild cabagge",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x =element_blank())+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")


#
##
###
#B. RAPA
###
##
#


brra_seed_set_final <- read.csv("Data/brra_seed_set_final.csv")
brra_seed_set_final=brra_seed_set_final[,-1]

#Different colour per family
b <- ggplot(brra_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Pak choi",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x =element_blank())+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")


#
##
###
#E. VERSICARIA
###
##
#

ersa_seed_set_final <- read.csv("Data/ersa_seed_set_final_common_names.csv")
ersa_seed_set_final=ersa_seed_set_final[,-1]


#Different colour per family
c <- ggplot(ersa_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Rocket",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")

##
###
#S. ALBA  
###
##
#

sial_seed_set_final <- read.csv("Data/sial_seed_set_final_common_names.csv")
sial_seed_set_final=sial_seed_set_final[,-1]



#Different colour per family
d <- ggplot(sial_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="White mustard",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")

gl <- lapply(list(a,b,c,d), ggplotGrob)
library(grid)
widths <- do.call(unit.pmax, lapply(gl, "[[", "widths"))
heights <- do.call(unit.pmax, lapply(gl, "[[", "heights"))
lg <- lapply(gl, function(g) {g$widths <- widths; g$heights <- heights; g})



grobz <- lapply(list(a, b, c, d), ggplotGrob)
grobz.plot <- arrangeGrob( grobs = list(rbind(grobz[[1]], grobz[[3]], size = "last"),
                                        rbind(grobz[[2]], grobz[[4]], size = "last")), ncol = 2,top="Brassicaceae Focal species")

grid.draw(grobz.plot)


```

\newpage
```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=3.7, fig.width=7,out.width='100%'}


library(reshape2)
library(ggplot2)
library(dplyr)
library(gridExtra)
library(grid)
library(lattice)

#Preparing seed set plots, starting with Petunia
#
##
###
#I. AQUATICA
###
##
#
ipaq_seed_set_final <- read.csv("Data/ipaq_seed_set_final_common_names.csv")
ipaq_seed_set_final=ipaq_seed_set_final[,-1]

cbPalette <- c( "#56B4E9","#E69F00", "#999999", "#009E73")


#Different colour per family
a <- ggplot(ipaq_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Water morning glory",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")

#IPPU
ippu_seed_set_final <- read.csv("Data/ippu_seed_set_final_common_names.csv")
ippu_seed_set_final=ippu_seed_set_final[,-1]



#Different colour per family
b <- ggplot(ippu_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Morning glory",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")


#There are 3 crosses were seeds were lost (2,7,9)
#load libraries

#read data and cleaning

gl <- lapply(list(a,b), ggplotGrob)
library(grid)
widths <- do.call(unit.pmax, lapply(gl, "[[", "widths"))
heights <- do.call(unit.pmax, lapply(gl, "[[", "heights"))
lg <- lapply(gl, function(g) {g$widths <- widths; g$heights <- heights; g})



grobz <- lapply(list(a, b), ggplotGrob)
grobz.plot <- arrangeGrob(grobs = list(rbind(grobz[[1]], size = "last"),
                                        rbind(grobz[[2]], size = "last")), ncol = 2,top="Convolvulaceae")

grid.draw(grobz.plot)

```


\newpage
#CHOLOROPLAST RBCL PHYLOGENY
```{r echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('Images/all_species.png')
```

\newpage
###POLLEN MIX RATIOS PER FAMILY -3 NEXT PAGES- (N=3)
```{r, message=FALSE, warning=FALSE, echo=FALSE,fig.width=8}
pollen_ratios_brassicaceae <- read.csv("Data/pollen_ratios_brassicaceae.csv", header = T)
ggplot(pollen_ratios_brassicaceae, aes(x=spp, y=ratio, fill=variable)) +
  geom_bar(stat='identity', position='dodge') +labs(title="Brassicaceae", x="", y="Pollen mix ratio") + 
  theme(axis.text.x=element_text(angle=60,hjust=1))+geom_hline(yintercept = 50)+
  scale_fill_manual(values=c("grey10", "grey60"))+ ylim(0,100)

```
\newpage
```{r, message=FALSE, warning=FALSE, echo=FALSE,fig.width=8}
pollen_ratios_solanaceae <- read.csv("Data/pollen_ratios_solanaceae.csv", header = T)
ggplot(pollen_ratios_solanaceae, aes(x=spp, y=ratio, fill=variable)) +
  geom_bar(stat='identity', position='dodge') +labs(title="Solanaceae", x="", y="Pollen mix ratio") +
  theme(axis.text.x=element_text(angle=60,hjust=1))+geom_hline(yintercept = 50)+
  scale_fill_manual(values=c("grey10", "grey60"))+ ylim(0,100)

```
\newpage
```{r, message=FALSE, warning=FALSE, echo=FALSE,fig.width=8}
pollen_ratios_convolvulaceae <- read.csv("Data/pollen_ratios_convolvulaceae.csv", header = T)
ggplot(pollen_ratios_convolvulaceae, aes(x=spp, y=ratio, fill=variable)) + 
  geom_bar(stat='identity', position='dodge') +labs(title="Convolvulaceae", x="", y="Pollen mix ratio") + 
  theme(axis.text.x=element_text(angle=60,hjust=1))+geom_hline(yintercept = 50)+
  scale_fill_manual(values=c("grey10", "grey60"))+ ylim(0,100)

```

\newpage
###TOTAL POLLEN ON STIGMA -NEXT 3 PAGES-
```{r, message=FALSE, warning=FALSE, echo=FALSE,fig.width=8}
total_pollen_brassicaceae <- read.csv("Data/total_pollen_brassicaceae.csv", header=T)

ggplot(total_pollen_brassicaceae, aes(x=spp, y=ratio, fill=variable)) +
  geom_bar(stat='identity', position='dodge') +labs(title="Brassicaceae", x="", y="Pollen grains on stigma") + 
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_fill_manual(values=c("grey10", "grey60"))

```

\newpage
```{r, message=FALSE, warning=FALSE, echo=FALSE,fig.width=8}

total_pollen_solanaceae <- read.csv("Data/total_pollen_solanaceae.csv", header=T)


ggplot(total_pollen_solanaceae, aes(x=spp, y=ratio, fill=variable)) +
  geom_bar(stat='identity', position='dodge') +labs(title="Solanaceae", x="", y="Pollen mix ratio") +
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_fill_manual(values=c("grey10", "grey60"))

```
\newpage

```{r, message=FALSE, warning=FALSE, echo=FALSE,fig.width=8}

total_pollen_convolvulaceae <- read.csv("Data/total_pollen_convolvulaceae.csv", header=T)

ggplot(total_pollen_convolvulaceae, aes(x=spp, y=ratio, fill=variable)) + 
  geom_bar(stat='identity', position='dodge') +labs(title="Convolvulaceae", x="", y="Pollen mix ratio") + 
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_fill_manual(values=c("grey10", "grey60"))



```

\newpage
###POLLEN PER ANTHER (N=20, I. aquatica N=10)
```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=3}
library(ggplot2)


all <- read.csv("Data/all.csv", header=T)

cbPalette <- c( "#56B4E9","#E69F00","#009E73")

#all

 ggplot(all, aes(x = reorder(species, pollen, FUN = median, na.rm = TRUE), y = pollen)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="All species",x="", y = "Pollen per anther")+aes(fill=family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.title = element_blank())
 
#Samte thing but without eggplant to improve visualization
 
#all

 all <- all[all$species !="Eggplant",]
 
 
 ggplot(all, aes(x = reorder(species, pollen, FUN = median, na.rm = TRUE), y = pollen)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="All species(-Eggplant)",x="", y = "Pollen per anther")+aes(fill=family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.title = element_blank())
 
 

```

\newpage
###OVULES (N=15)
```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=3}

d <- read.csv("Data/d.csv")

cbPalette <- c( "#56B4E9","#E69F00","#009E73")

ggplot(d, aes(x = reorder(species, ovules, FUN = median, na.rm = TRUE), y = ovules)) +
  geom_boxplot(outlier.shape = NA)+labs(title="All species",x="", y = "Nº of ovules")+
  aes(fill=family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+
  geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=family))+
  scale_color_manual(values = cbPalette) + 
  stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.title = element_blank())

 d <- d[d$species !="Eggplant",]
 
 ggplot(d, aes(x = reorder(species, ovules, FUN = median, na.rm = TRUE), y = ovules)) +
  geom_boxplot(outlier.shape = NA)+labs(title="All species(-Eggplant)",x="", y = "Nº of ovules")+
  aes(fill=family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+
  geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=family))+
  scale_color_manual(values = cbPalette) + 
  stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.title = element_blank())
```

\newpage

###POLLEN OVULE RATIO. TOTAL POLLEN PER FLOWER DIVIDED BY NUMBER OF OVULES

```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=6}
library(dplyr)
library(ggplot2)

tab <- read.csv("Data/tab_common_names.csv", sep="", header = T)

ggplot(tab, aes(x=reorder(species, pollen_ovule_ratio, colour = cut), y=pollen_ovule_ratio))+aes(fill=family)+
  geom_bar(stat="identity", width=0.5)+theme(axis.text.x = element_text(angle = 60, hjust=1))+scale_fill_manual(values=cbPalette)
```

\newpage

###STIGMA AREA. BRASSICACEAE+1 AND SOLANACEAE+1

```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=6}

t_stigma_area <- read.csv("Data/t_stigma_area.csv")
t_stigma_area_brassicaceae <- read.csv("Data/t_stigma_area_brassicaceae.csv")
t_stigma_area_solanaceae <- read.csv("Data/t_stigma_area_solanaceae.csv")
t_stigma_area_convolvulaceae <- read.csv("Data/t_stigma_area_convolvulaceae.csv")

theme_set(theme_gray())
a <- ggplot(t_stigma_area_brassicaceae, aes(x = um, fill = species_common)) +
  geom_density(alpha = 0.7) +
  theme(legend.position = c(0.8, 0.8))

b <- ggplot(t_stigma_area_solanaceae, aes(x = um, fill = species_common)) +
  geom_density(alpha = 0.7) +
  theme(legend.position = c(0.8, 0.8))

cowplot::plot_grid(a,b, labels = "AUTO")
```

\newpage

###STIGMA AREA. ALL SPECIES, COLOUR PER SPECIES AND FAMILY

```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=6}

t_stigma_area <- read.csv("Data/t_stigma_area.csv")
t_stigma_area_brassicaceae <- read.csv("Data/t_stigma_area_brassicaceae.csv")
t_stigma_area_solanaceae <- read.csv("Data/t_stigma_area_solanaceae.csv")
t_stigma_area_convolvulaceae <- read.csv("Data/t_stigma_area_convolvulaceae.csv")

theme_set(theme_gray())
a <- ggplot(t_stigma_area, aes(x = um, fill = species_common)) +
  geom_density(alpha = 0.7) +
  theme(legend.position = c(0.8, 0.8))

cowplot::plot_grid(a, labels = "AUTO")

###All Area per family

theme_set(theme_gray())
a <- ggplot(t_stigma_area, aes(x = um, fill = family)) +
  geom_density(alpha = 0.7) +
  theme(legend.position = c(0.8, 0.8))

cowplot::plot_grid(a, labels = "AUTO")

```


