---
title: "Data_visualization"
output:
      pdf_document
---
```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=6, fig.width=7,out.width='100%'}
#Preparing seed set plots, starting with Petunia

#There are 3 crosses were seeds were lost (2,7,9)
#load libraries
library(reshape2)
library(ggplot2)
library(dplyr)
library(gridExtra)
library(grid)
library(lattice)
#read data and cleaning
pein_seed_set_final <- read.csv("Data/pein_seed_set_final_common_names.csv")
pein_seed_set_final=pein_seed_set_final[,-1]
#load the palette for all the 4 plots
cbPalette <- c( "#56B4E9","#E69F00", "#999999", "#009E73")
#Colur per family

a <- ggplot(pein_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Petunia",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x =element_blank())+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")



#
##
###
#C. ANNUUM 
###
##
#
caan_seed_set_final <- read.csv("Data/caan_seed_set_final.csv")
caan_seed_set_final=caan_seed_set_final[,-1]


#Colur per family
#Different colour per family
b <- ggplot(caan_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Capsicum",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x =element_blank())+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")



#
##
###
#S. LYCOPERSICUM
###
##
#


soly_seed_set_final <- read.csv("Data/soly_seed_set_final_common_names.csv")
soly_seed_set_final=soly_seed_set_final[,-1]

cbPalette <- c( "#56B4E9","#E69F00", "#999999", "#009E73")
#Different colour per family
c <- ggplot(soly_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Tomato",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")


#
##
###
#S. MELONGENA
###
##
#


some_seed_set_final <- read.csv("Data/some_seed_set_final_common_names.csv")
some_seed_set_final=some_seed_set_final[,-1]


#Different colour per family
d <- ggplot(some_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Eggplant",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")



gl <- lapply(list(a,b,c,d), ggplotGrob)
library(grid)
widths <- do.call(unit.pmax, lapply(gl, "[[", "widths"))
heights <- do.call(unit.pmax, lapply(gl, "[[", "heights"))
lg <- lapply(gl, function(g) {g$widths <- widths; g$heights <- heights; g})



grobz <- lapply(list(a, b, c, d), ggplotGrob)
grobz.plot <- arrangeGrob( grobs = list(rbind(grobz[[1]], grobz[[3]], size = "last"),
                                        rbind(grobz[[2]], grobz[[4]], size = "last")),
                           ncol = 2, top="Solanaceae Focal Species")

grid.draw(grobz.plot)

```


```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=6, fig.width=7,out.width='100%'}
library(dplyr)

#load libraries
library(reshape2)
library(ggplot2)
library(dplyr)
library(gridExtra)
library(grid)
library(lattice)
library(gtable)
##
###
#B. OLERACEA
###
##
#

brol_seed_set_final <- read.csv("Data/brol_seed_set_final.csv")
brol_seed_set_final=brol_seed_set_final[,-1]
#Different colour per family
a <- ggplot(brol_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Wild cabagge",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x =element_blank())+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")


#
##
###
#B. RAPA
###
##
#


brra_seed_set_final <- read.csv("Data/brra_seed_set_final.csv")
brra_seed_set_final=brra_seed_set_final[,-1]

#Different colour per family
b <- ggplot(brra_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Pak choi",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x =element_blank())+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")


#
##
###
#E. VERSICARIA
###
##
#

ersa_seed_set_final <- read.csv("Data/ersa_seed_set_final_common_names.csv")
ersa_seed_set_final=ersa_seed_set_final[,-1]


#Different colour per family
c <- ggplot(ersa_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Rocket",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")

##
###
#S. ALBA  
###
##
#

sial_seed_set_final <- read.csv("Data/sial_seed_set_final_common_names.csv")
sial_seed_set_final=sial_seed_set_final[,-1]



#Different colour per family
d <- ggplot(sial_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="White mustard",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")

gl <- lapply(list(a,b,c,d), ggplotGrob)
library(grid)
widths <- do.call(unit.pmax, lapply(gl, "[[", "widths"))
heights <- do.call(unit.pmax, lapply(gl, "[[", "heights"))
lg <- lapply(gl, function(g) {g$widths <- widths; g$heights <- heights; g})



grobz <- lapply(list(a, b, c, d), ggplotGrob)
grobz.plot <- arrangeGrob( grobs = list(rbind(grobz[[1]], grobz[[3]], size = "last"),
                                        rbind(grobz[[2]], grobz[[4]], size = "last")), ncol = 2,top="Brassicaceae Focal species")

grid.draw(grobz.plot)


```

\newpage
```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=3.7, fig.width=7,out.width='100%'}


library(reshape2)
library(ggplot2)
library(dplyr)
library(gridExtra)
library(grid)
library(lattice)

#Preparing seed set plots, starting with Petunia
#
##
###
#I. AQUATICA
###
##
#
ipaq_seed_set_final <- read.csv("Data/ipaq_seed_set_final_common_names.csv")
ipaq_seed_set_final=ipaq_seed_set_final[,-1]

cbPalette <- c( "#56B4E9","#E69F00", "#999999", "#009E73")


#Different colour per family
a <- ggplot(ipaq_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Water morning glory",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")

#IPPU
ippu_seed_set_final <- read.csv("Data/ippu_seed_set_final_common_names.csv")
ippu_seed_set_final=ippu_seed_set_final[,-1]



#Different colour per family
b <- ggplot(ippu_seed_set_final, aes(x = factor(Treatment, levels=unique(Treatment)), y = Seed.production)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="Morning glory",x="", y = "Seeds")+aes(fill=Family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=Family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")


#There are 3 crosses were seeds were lost (2,7,9)
#load libraries

#read data and cleaning

gl <- lapply(list(a,b), ggplotGrob)
library(grid)
widths <- do.call(unit.pmax, lapply(gl, "[[", "widths"))
heights <- do.call(unit.pmax, lapply(gl, "[[", "heights"))
lg <- lapply(gl, function(g) {g$widths <- widths; g$heights <- heights; g})



grobz <- lapply(list(a, b), ggplotGrob)
grobz.plot <- arrangeGrob(grobs = list(rbind(grobz[[1]], size = "last"),
                                        rbind(grobz[[2]], size = "last")), ncol = 2,top="Convolvulaceae")

grid.draw(grobz.plot)

```
\newpage
```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=3.8}
#load libraries

library(ggplot2)
library(colorspace)
library(gridExtra)

colours <- rainbow_hcl(4, start = 30, end = 300)
#load data

par(mfrow=c(2,1))
d<-read.csv("Data/Ovules.csv", sep=";")
d<- d[,-c(9,11)]
colnames(d)[1]<-"C. annuum"
colnames(d)[2]<-"S. lycopersicum"
colnames(d)[3]<-"S. melongera"
colnames(d)[4]<-"P. integrifolia"
colnames(d)[5]<-"B. oleracea"
colnames(d)[6]<-"B. rapa"
colnames(d)[7]<-"E. sativa"
colnames(d)[8]<-"S. alba"
colnames(d)[9]<-"I. aquatica"
colnames(d)[10]<-"I. purpurea"


#Reorganise data
d <- stack(d)
#Naming columns
colnames(d)[1]<-"ovules"
colnames(d)[2]<-"species"

family<- c(rep("solanaceae",60),rep("brassicaceae",60),rep("convolvulaceae",30))

d[,"family"] <- family




#subset per family (solanaceae, brassicaceae, convolvulaceae)
solanaceae<-subset(d)[1:60,]
brassicaceae<-subset(d)[61:120,]

# OVULES SOLANACEAE
p <- ggplot(solanaceae, aes(x = reorder(species, ovules, FUN = median), y = ovules)) +   geom_boxplot()+
labs(title="Solanaceae",x="", y = "Ovules")+aes(fill=species)+scale_fill_manual(values=colours)+
theme(plot.title = element_text(hjust = 0.5))

p + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none") 


# OVULES BRASSICACEAE
p <- ggplot(brassicaceae, aes(x = reorder(species, ovules, FUN = median), y = ovules)) +   geom_boxplot()+
labs(title="Brassicaceae",x="", y = "Ovules")+aes(fill=species)+scale_fill_manual(values=colours)+
theme(plot.title = element_text(hjust = 0.5))

p + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none") 

#all species
#formating d, to have just the spp of interest



p <- ggplot(d, aes(x = reorder(species, ovules, FUN = median), y = ovules)) +   geom_boxplot()+
labs(title="Ovules per spp.",x="", y = "Ovules")+aes(fill=family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
theme(plot.title = element_text(hjust = 0.5))

p + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none")

```


#Pollen per anther, just one Convolvulaceae at the moment
```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=3}
library(ggplot2)


p <- read.csv("data/Pollen.csv", sep = ";")

#Deleting extra row (21)
p <-p[-21,]

#boxplot(p)
#Reorganize data for ggplot
p<-stack(p)
#colnames
colnames(p)[1]<-"pollen"
colnames(p)[2]<-"species"

all<-p
solanaceae<-subset(p)[1:100,]
brassicaceae<- subset(p)[101:180,]

#Solanaceae
p <- ggplot(solanaceae, aes(x = reorder(species, pollen, FUN = median), y = pollen)) +   geom_boxplot()+
labs(title="Solanaceae",x="", y = "pollen")+aes(fill=species)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
theme(plot.title = element_text(hjust = 0.5))

p + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none")

#Brassicaceae
p <- ggplot(brassicaceae, aes(x = reorder(species, pollen, FUN = median), y = pollen)) +   geom_boxplot()+
labs(title="Brassicaceae",x="", y = "pollen")+aes(fill=species)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
theme(plot.title = element_text(hjust = 0.5))

p + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none")


#all
p <- ggplot(all, aes(x = reorder(species, pollen, FUN = median), y = pollen)) +   geom_boxplot()+
labs(title="All species",x="", y = "pollen")+aes(fill=species)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
theme(plot.title = element_text(hjust = 0.5))

p + stat_summary(fun.y=mean, geom="point", shape="*", size=5, colour="black") +theme(legend.position="none")
```

```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=6}
tab <- read.csv("Data/tab.csv", sep="", header = T)

p <- ggplot(data=tab, aes(x=reorder(species, pollen_ovule_ratio, colour = cut), y=pollen_ovule_ratio))+aes(fill=family)+
  geom_bar(stat="identity", width=0.5)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  scale_fill_manual(values=colours)
p + ggtitle("Pollen/ovule ratio per species") + theme(plot.title = element_text(hjust = 0.5))+ labs(x = "Species")


```



```{r echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('Images/all_species.png')
```

\newpage
```{r, message=FALSE, warning=FALSE, echo=FALSE,fig.width=8}
pollen_ratios_brassicaceae <- read.csv("Data/pollen_ratios_brassicaceae.csv", header = T)
ggplot(pollen_ratios_brassicaceae, aes(x=spp, y=ratio, fill=variable)) +
  geom_bar(stat='identity', position='dodge') +labs(title="Brassicaceae", x="", y="Pollen mix ratio") + 
  theme(axis.text.x=element_text(angle=60,hjust=1))+geom_hline(yintercept = 50)+
  scale_fill_manual(values=c("grey10", "grey60"))+ ylim(0,100)

```
\newpage
```{r, message=FALSE, warning=FALSE, echo=FALSE,fig.width=8}
pollen_ratios_solanaceae <- read.csv("Data/pollen_ratios_solanaceae.csv", header = T)
ggplot(pollen_ratios_solanaceae, aes(x=spp, y=ratio, fill=variable)) +
  geom_bar(stat='identity', position='dodge') +labs(title="Solanaceae", x="", y="Pollen mix ratio") +
  theme(axis.text.x=element_text(angle=60,hjust=1))+geom_hline(yintercept = 50)+
  scale_fill_manual(values=c("grey10", "grey60"))+ ylim(0,100)

```
\newpage
```{r, message=FALSE, warning=FALSE, echo=FALSE,fig.width=8}
pollen_ratios_convolvulaceae <- read.csv("Data/pollen_ratios_convolvulaceae.csv", header = T)
ggplot(pollen_ratios_convolvulaceae, aes(x=spp, y=ratio, fill=variable)) + 
  geom_bar(stat='identity', position='dodge') +labs(title="Convolvulaceae", x="", y="Pollen mix ratio") + 
  theme(axis.text.x=element_text(angle=60,hjust=1))+geom_hline(yintercept = 50)+
  scale_fill_manual(values=c("grey10", "grey60"))+ ylim(0,100)

```


\newpage
```{r,message=FALSE, warning=FALSE, echo=FALSE, cache=FALSE, fig.height=3}
library(ggplot2)


all <- read.csv("Data/all.csv", header=T)

cbPalette <- c( "#56B4E9","#E69F00","#009E73")

#all

 ggplot(all, aes(x = reorder(species, pollen, FUN = median, na.rm = TRUE), y = pollen)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="All species",x="", y = "Pollen per anther")+aes(fill=family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")
 
#Samte thing but without eggplant to improve visualization
 
#all

 all <- all[all$species !="Eggplant",]
 
 
 ggplot(all, aes(x = reorder(species, pollen, FUN = median, na.rm = TRUE), y = pollen)) +   geom_boxplot(outlier.shape = NA)+
  labs(title="All species",x="", y = "Pollen per anther")+aes(fill=family)+theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  theme(plot.title = element_text(hjust = 0.5)) +scale_fill_manual(values=cbPalette)+ geom_jitter(width = 0.3,shape=1,size=0.8, aes(colour=family))+scale_color_manual(values = cbPalette) + stat_summary(fun.y=mean, geom="point", shape="*", size=5) +theme(legend.position="none")
 
 

```
\newpage

