---
output:
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    toc: no
  html_document:
    toc: no
    df_print: paged
fontsize: 12pt
header-includes:
- \usepackage{setspace}\doublespacing
- \usepackage{float}
- \usepackage{caption}

---
\captionsetup[figure]{labelformat=empty}
\captionsetup[table]{labelformat=empty}
\renewcommand{\figurename}{}

# Supporting information:

# Recipient and donor characteristics govern hierarchical structure in a heterospecific pollen competition network of co-flowering plants

__Authors:__ Jose B. Lanuza, Ignasi Bartomeus, Tia Lynn Ashman, Romina Rader

The following Supporting Information is available for this article:

__Table S1.__ Species names, common names, varieties and sources of the different seeds.

__Table S2.__ Numerical values of all the traits measured for each species.

__Table S3.__ Seed set in percentage for hand cross-pollination, hand self-pollination, natural selfing and apomixis for all species.

__Table S4.__ Species x species matrix with the significance of effect “yes” or “no” of the different donors on the seed set of the different recipient species.

__Table S5.__ Estimates, standard error, t-value and P-value of the effect of the different 9 donors on each recipient species.

__Table S6.__ Number of seeds produced with 100% foreign pollen treatments for the different recipient species. 

__Table S7.__ Phylogenetic signal and significance for all the different traits

__Table S8.__ Procrustes analysis results.

__Figure S1.__ Correlation matrix for all the different traits.

__Figure S2.__ Total amount of pollen found for the different treatments.

__Figure S3.__ Pollen ratios for the different recipient species.

__Figure S4.__ Pollen ratios for the different recipient species by family.

__Figure S5.__ Statistical comparison of pollen ratios by family as pollen donor and recipient.

__Figure S6.__ Violin plot of the reproductive biology of the species.

__Figure S7.__ Grouped effect sizes by family for each recipient species.

\newpage

#TABLE S1
```{r, echo=FALSE, warning=FALSE, fig.align="center", out.width='80%'}
library(knitr)
library(kableExtra)
Species <- c("Brassica oleracea", "Brassica rapa", "Eruca sativa", "Sinapis alba", "Ipomoea aquatica", "Ipomoea purpurea", "Capsicum annuum", "Petunia integrifolia", "Solanum lycopersicum", "Solanum melongena")
Species <- as.character(Species)
  
Common_names <- c("Wild cabbage", "Pak choi", "Rocket", "White mustard", "Water spinach", "Morning glory", "Capsicum", "Petunia", "Tomato", "Eggplant")
Common_names <- as.character(Common_names)
Variety <- c("Capitata", "Chinensis", "", "", "", "", "California Wonder", "", "Tommy Toe", "Little Fingers") 
Variety <- as.character(Variety)
Source <- c("https://www.mrfothergills.com.au/", "https://www.mrfothergills.com.au/", "https://www.mrfothergills.com.au/", "https://www.mrfothergills.com.au/", "https://www.theseedcollection.com.au/", "http://www.shaman-australis.com.au", "https://www.edenseeds.com.au", "https://www.dianeseeds.com/", "https://www.mrfothergills.com.au/", "https://www.4seasonsseeds.com.au/")
Source <- as.character(Source)
t <- data.frame(Species, Common_names, Variety, Source)
kable(t, format = "latex", longtable = T, booktabs = T,linesep = "\\addlinespace") %>%
  kable_styling(latex_options = c("repeat_header","striped"), font_size = 7, full_width=T) %>% row_spec(0,bold=TRUE)  
```

\begin{landscape}

TABLE S2
```{r, echo=FALSE, warning=FALSE, fig.align="center", out.width='80%'}
library(kableExtra)

dat <- readRDS("Tables/traits_supplementary.rds")
#Convert to square mm and mm
dat$stigma_area <- dat$stigma_area/1000000
dat[,c(7:12)] <- dat[,c(7:12)]/1000

colnames(dat) <- c("Species", "Pollen size $\\mu$m", "Pollen grains per anther", "Ovule number", "Pollen:ovule ratio", "Stigma area $\\mu$m$^{2}$", "Stigma length (mm)", "Stigma width (mm)", "Style length (mm)", "Style width (mm)", "Ovary length (mm)", "Ovary width (mm)", "Selfing rate", "SI index")



kable(dat, "latex", longtable = F, escape = FALSE,digits=2,booktabs = T,linesep = "\\addlinespace") %>% kable_styling(font_size = 6, full_width=T,latex_options = c("striped","scale_down")) %>% row_spec(0,bold=TRUE)  %>% column_spec(1, width = "2cm")
```

\end{landscape}

TABLE S3
```{r, echo=FALSE, warning=FALSE, fig.align="center", out.width='80%'}
library(kableExtra)
dat <- readRDS("Tables/rep_biology_supplementary.rds")
kable(dat, "latex", longtable = F, escape = FALSE,digits=2,booktabs = T,linesep = "\\addlinespace") %>% kable_styling(font_size = 6, full_width=T,latex_options = c("striped","scale_down")) %>% row_spec(0,bold=TRUE)  %>% column_spec(1, width = "2cm")
```


\newpage


```{r, echo=FALSE, message=FALSE, warning=FALSE,cache=FALSE,fig.height=6,fig.width=12, out.width = "100%", fig.align='center'}
setwd("~/R_projects/Hp_pollen_experiment")

#Script to plot the reproductive biology tests
#load libraries
library(ggplot2)
#install.packages("devtools")
library(devtools)
#install_github("easyGgplot2", "kassambara")

brol <- read.csv("Raw_data/brol_seed_set_final.csv")
brra <- read.csv("Raw_data/brra_seed_set_final.csv")
ersa <- read.csv("Raw_data/ersa_seed_set_final.csv")
sial <- read.csv("Raw_data/sial_seed_set_final.csv")
ipaq <- read.csv("Raw_data/ipaq_seed_set_final.csv")
ippu <- read.csv("Raw_data/ippu_seed_set_final.csv")
caan <- read.csv("Raw_data/caan_seed_set_final.csv")
pein <- read.csv("Raw_data/pein_seed_set_final.csv")
soly <- read.csv("Raw_data/soly_seed_set_final.csv")
some <- read.csv("Raw_data/some_seed_set_final.csv")
#loading traits to divide by number of ovules the seed set 
traits <- read.csv("Data/Csv/traits_scinames.csv")


brol_r <- subset(brol, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="FC")
brol_r$Seed_set <- brol_r$Seed.production/traits[1,8]*100
brra_r <- subset(brra, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="Flower Control")
brra_r$Seed_set <- brra_r$Seed.production/traits[2,8]*100
ersa_r <- subset(ersa, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="Flower Control")
ersa_r$Seed_set <- ersa_r$Seed.production/traits[4,8]*100
sial_r <- subset(sial, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="Flower Control")
sial_r$Seed_set <- sial_r$Seed.production/traits[8,8]*100
ipaq_r <- subset(ipaq, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="Flower control")
ipaq_r$Seed_set <- ipaq_r$Seed.production/traits[5,8]*100
ippu_r <- subset(ippu, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="Flower control")
ippu_r$Seed_set <- ippu_r$Seed.production/traits[6,8]*100
caan_r <- subset(caan, Treatment=="CROSS"|Treatment=="SELF"|Treatment=="CONTROL"|Treatment=="FLOWER CONTROL")
caan_r$Seed_set <- caan_r$Seed.production/traits[3,8]*100
pein_r <- subset(pein, Treatment=="CROSS"|Treatment=="SELF"|Treatment=="CONTROL"|Treatment=="FLOWER CONTROL")
pein_r$Seed_set <- pein_r$Seed.production/traits[7,8]*100
soly_r <- subset(soly, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="Flower control")
soly_r$Seed_set <- soly_r$Seed.production/traits[9,8]*100
some_r <- subset(some, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="Flower control")
some_r$Seed_set <- some_r$Seed.production/traits[10,8]*100

d <- rbind(brol_r,brra_r,ersa_r,sial_r,ipaq_r,ippu_r,caan_r,pein_r,soly_r,some_r)
d$Seed_set[d$Seed_set>100]<-100

#levels(d$Treatment)
d$Treatment=as.character(d$Treatment)
d$Treatment[d$Treatment=="Cross"]<-"Hand cross-pollination"
d$Treatment[d$Treatment=="CROSS"]<-"Hand cross-pollination"
d$Treatment[d$Treatment=="Self"]<-"Hand self-pollination"
d$Treatment[d$Treatment=="SELF"]<-"Hand self-pollination"
d$Treatment[d$Treatment=="SELF"]<-"Hand self-pollination"
d$Treatment[d$Treatment=="Control"]<-"Apomixis"
d$Treatment[d$Treatment=="CONTROL"]<-"Apomixis"
d$Treatment[d$Treatment=="FC"]<-"Spontaneous selfing"
d$Treatment[d$Treatment=="Flower control"]<-"Spontaneous selfing"
d$Treatment[d$Treatment=="FLOWER CONTROL"]<-"Spontaneous selfing"
d$Treatment[d$Treatment=="Flower Control"]<-"Spontaneous selfing"

d$Species=as.character(d$Species)
d$Species[d$Family=="BROL"]<-"B"
d$Species[d$Family=="BRRA"]<-"B"
d$Species[d$Family=="ERSA"]<-"B"
d$Species[d$Family=="SIAL"]<-"B"
d$Species[d$Family=="IPPU"]<-"C"
d$Species[d$Family=="IPAQ"]<-"C"
d$Species[d$Family=="SOME"]<-"S"
d$Species[d$Family=="SOLY"]<-"S"
d$Species[d$Family=="PEIN"]<-"S"
d$Species[d$Family=="CAAN"]<-"S"

d$Species[d$Species=="BROL"]<-"B. oleracea"
d$Species[d$Species=="BRRA"]<-"B. rapa"
d$Species[d$Species=="SIAL"]<-"S. alba"
d$Species[d$Species=="ERSA"]<-"E. sativa"
d$Species[d$Species=="IPPU"]<-"I. purpurea"
d$Species[d$Species=="IPAQ"]<-"I. aquatica"
d$Species[d$Species=="SOLY"]<-"S. lycopersicum"
d$Species[d$Species=="SOME"]<-"S. melongena"
d$Species[d$Species=="PEIN"]<-"P. integrifolia"
d$Species[d$Species=="CAAN"]<-"C. annuum"

cbPalette <- c( "#56B4E9","#E69F00", "#999999", "#009E73")

rep_bio <- ggplot(d, aes(x=Species, y=Seed_set, fill=Treatment)) + 
  geom_violin(scale = "width",draw_quantiles = c(0.5))+
  geom_dotplot(binaxis='y', 
               dotsize=0.15,stackdir='center',position = position_jitterdodge(jitter.width = 0.01))+
  theme_minimal()+labs(y="Seed:ovule ratio")+scale_fill_manual(values=c( "#D55E00","#009E73","#0072B2", "#E69F00"))+theme(legend.title = element_blank(),plot.title = element_text(face = "bold"),axis.text.x = element_text(face = "italic"))
 
rep_bio
 #pdf("test.pdf", width = 12, height = 5)
 
 #ggsave("Images_publication/Figure2.png", width = 12, height = 5,dpi = 1200)
 
ggsave(filename = "rep_bio.pdf", rep_bio, width = 12, height = 5, units = "in",dpi = 1000)

# insert ggplot code
dev.off()



```

\newpage


```{r, echo=FALSE, message=FALSE, warning=FALSE,cache=FALSE,fig.height=9,fig.width=7, fig.cap="S7"}

library(effsize)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(cowplot)
library(gridExtra)
library(egg)
library(magrittr)
library(multipanelfigure)
library(grid)

setwd("~/R_projects/Hp_pollen_experiment")
load("Data/RData/some_effect_size_family.RData")

pp1<- ggplot(some_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")



load("Data/RData/soly_effect_size_family.RData")

pp2<- ggplot(soly_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")


load("Data/RData/sial_effect_size_family.RData")

p3<- ggplot(sial_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")


load("Data/RData/pein_effect_size_family.RData")

p4<- ggplot(pein_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")


load("Data/RData/ippu_effect_size_family.RData")

p5<- ggplot(ippu_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")

load("Data/RData/ipaq_effect_size_family.RData")

p6<- ggplot(ipaq_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")

load("Data/RData/ersa_effect_size_family.RData")

p7<- ggplot(ersa_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")

load("Data/RData/caan_effect_size_family.RData")

p8<- ggplot(caan_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")

load("Data/RData/brra_effect_size_family.RData")

p9<- ggplot(brra_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")


load("Data/RData/brol_effect_size_family.RData")

p10<- ggplot(brol_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")

 #grid.arrange(p1, p5, p3, p4, nrow=2,ncol=2,top="Solanaceae")
grid.newpage()
 grid.draw(arrangeGrob(cbind(ggplotGrob(pp1),ggplotGrob(pp2), size="last"),cbind(ggplotGrob(p3),ggplotGrob(p4),size="last"),cbind(ggplotGrob(p5),ggplotGrob(p6), size="last"),cbind(ggplotGrob(p7),ggplotGrob(p8), size="last"),cbind(ggplotGrob(p9),ggplotGrob(p10), size="last"),nrow=5))
```




