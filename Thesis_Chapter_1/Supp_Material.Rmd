---
output:
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    toc: no
  html_document:
    toc: no
    df_print: paged
fontsize: 12pt
header-includes:
- \usepackage{setspace}\doublespacing
- \usepackage{float}
- \usepackage{caption}

---
\captionsetup[figure]{labelformat=empty}
\captionsetup[table]{labelformat=empty}
\renewcommand{\figurename}{}

# Supporting information:

# Recipient and donor characteristics govern hierarchical structure in a heterospecific pollen competition network of co-flowering plants

__Authors:__ Jose B. Lanuza, Ignasi Bartomeus, Tia Lynn Ashman, Romina Rader

The following Supporting Information is available for this article:

__Table S1.__ Species names, common names, varieties and sources of the different seeds.

__Table S2.__ Numerical values of all the traits measured for each species.

__Table S3.__ Seed set in percentage for hand cross-pollination, hand self-pollination, natural selfing and apomixis for all species.

__Table S4.__ Species x species matrix with the significance of effect “yes” or “no” of the different donors on the seed set of the different recipient species.

__Table S5.__ Estimates, standard error, t-value and P-value of the effect of the different 9 donors on each recipient species.

__Table S6.__ Number of seeds produced with 100% foreign pollen treatments for the different recipient species. 

__Table S7.__ Phylogenetic signal and significance for all the different traits

__Table S8.__ Procrustes analysis results.

__Figure S1.__ Correlation matrix for all the different traits.

__Figure S2.__ Total amount of pollen found for the different treatments.

__Figure S3.__ Pollen ratios for the different recipient species.

__Figure S4.__ Pollen ratios for the different recipient species by family.

__Figure S5.__ Unipartite bidirectional network with asymmetrical effect

__Figure S6.__ Statistical comparison of pollen ratios by family as pollen donor and recipient.

__Figure S7.__ Violin plot of the reproductive biology of the species.

__Figure S8.__ Grouped effect sizes by family for each recipient species.


\newpage

#TABLE S1
```{r, echo=FALSE, warning=FALSE, fig.align="center", out.width='80%'}
library(knitr)
library(kableExtra)
Species <- c("Brassica oleracea", "Brassica rapa", "Eruca sativa", "Sinapis alba", "Ipomoea aquatica", "Ipomoea purpurea", "Capsicum annuum", "Petunia integrifolia", "Solanum lycopersicum", "Solanum melongena")
Species <- as.character(Species)
  
Common_names <- c("Wild cabbage", "Pak choi", "Rocket", "White mustard", "Water spinach", "Morning glory", "Capsicum", "Petunia", "Tomato", "Eggplant")
Common_names <- as.character(Common_names)
Variety <- c("Capitata", "Chinensis", "", "", "", "", "California Wonder", "", "Tommy Toe", "Little Fingers") 
Variety <- as.character(Variety)
Source <- c("https://www.mrfothergills.com.au/", "https://www.mrfothergills.com.au/", "https://www.mrfothergills.com.au/", "https://www.mrfothergills.com.au/", "https://www.theseedcollection.com.au/", "http://www.shaman-australis.com.au", "https://www.edenseeds.com.au", "https://www.dianeseeds.com/", "https://www.mrfothergills.com.au/", "https://www.4seasonsseeds.com.au/")
Source <- as.character(Source)
t <- data.frame(Species, Common_names, Variety, Source)
kable(t, format = "latex", longtable = T, booktabs = T,linesep = "\\addlinespace") %>%
  kable_styling(latex_options = c("repeat_header","striped"), font_size = 7, full_width=T) %>% row_spec(0,bold=TRUE)  
```

\begin{landscape}

TABLE S2
```{r, echo=FALSE, warning=FALSE, fig.align="center", out.width='80%'}
library(kableExtra)

dat <- readRDS("Tables/traits_supplementary.rds")
#Convert to square mm and mm
dat$stigma_area <- dat$stigma_area/1000000
dat[,c(7:12)] <- dat[,c(7:12)]/1000

colnames(dat) <- c("Species", "Pollen size $\\mu$m", "Pollen grains per anther", "Ovule number", "Pollen:ovule ratio", "Stigma area $\\mu$m$^{2}$", "Stigma length (mm)", "Stigma width (mm)", "Style length (mm)", "Style width (mm)", "Ovary length (mm)", "Ovary width (mm)", "Selfing rate", "SI index")



kable(dat, "latex", longtable = F, escape = FALSE,digits=2,booktabs = T,linesep = "\\addlinespace") %>% kable_styling(font_size = 6, full_width=T,latex_options = c("striped","scale_down")) %>% row_spec(0,bold=TRUE)  %>% column_spec(1, width = "2cm")
```

\end{landscape}

TABLE S3
```{r, echo=FALSE, warning=FALSE, fig.align="center", out.width='80%'}
library(kableExtra)
dat <- readRDS("Tables/rep_biology_supplementary.rds")
kable(dat, "latex", longtable = F, escape = FALSE,digits=2,booktabs = T,linesep = "\\addlinespace") %>% kable_styling(font_size = 6, full_width=T,latex_options = c("striped","scale_down")) %>% row_spec(0,bold=TRUE)  %>% column_spec(1, width = "2cm")
```


\newpage



```{r, echo=FALSE, message=FALSE, warning=FALSE,cache=FALSE,fig.height=9,fig.width=7, fig.cap="Fig S1"}
library(ggplot2)
setwd("~/R_projects/Hp_pollen_experiment")
total_pollen <- read.csv("Data/Csv/total_pollen.csv")
ggplot(total_pollen, aes(x=spp, y=ratio, fill=variable,width=.9)) +
  geom_bar(stat='identity', position='dodge')+theme_minimal()+
  theme(legend.title = element_blank(),axis.text.x=element_text(angle=60,hjust=1,face="italic"))+
  scale_fill_manual(values=c("#999999","#779799"),labels = c("Recipient","Donor"))+labs(x = "",y="Pollen on stigma")

```

\clearpage

```{r, echo=FALSE, message=FALSE, warning=FALSE,cache=FALSE,fig.height=9,fig.width=7,  fig.cap="**Fig S3** Average proportion of heterospecific pollen per family for the different 20 treatments counted. On the label of the y-axis, the first family is the pollen recipient family, and the second, the pollen donor family. These pollen ratios are the number of heterospecific pollen grains divided by the total pollen grains per stigma (conspecific and heterospecific pollen) and then averaged by family (N=20). The vertical bar on intercept 50, represents equal proportions of both recipient (grey) and donor (light blue) pollen."}
par(mar=c(30,13,2,4),xpd=F)
setwd("~/R_projects/Hp_pollen_experiment")
data_percentage <-readRDS("Data/RData/per.RData")
data_percentage=as.matrix(data_percentage)
coul = c("#999999","#779799")
barplot(data_percentage,hor=T, xlim=c(-1,100),ylim=c(-2,5),width = 0.5,col=coul ,space=0.5, border="white",srt=80,las=1,cex.axis=1,cex.names=1,names=c("Brassicaceae-Convolvulaceae",
 "Brassicaceae-Solanaceae","Convolvulaceae-Brassicaceae","Convolvulaceae-Solanaceae","Solanaceae-Convolvulaceae","Solanaceae-Brassicaceae"))
legend(-5,-0.5,legend=c("Recipient","Donor"),bty="n",fill = coul)
abline(v=50,col="black")

#lines(c(0,10),50,col="red")
```


\clearpage

```{r, echo=FALSE, message=FALSE, warning=FALSE,cache=FALSE,fig.height=7,fig.width=7, fig.cap=""}

par(mar=c(2,13,2,4),xpd=F)
par(mfrow=c(3,1))
setwd("~/R_projects/Hp_pollen_experiment")
ratio_bra <-readRDS("Data/RData/ratio_bra.RData")
barplot(ratio_bra,hor=T, xlim=c(-1,100),ylim=c(-2,7),width = 0.5,col=coul ,space=0.5,border="white",srt=80,las=1,cex.axis=1,cex.names=1,font=3,names=c("E. sativa-I. purpurea", "B. oleracea-I. purpurea","B. rapa-I. purpurea", "S. alba-I. aquatica", "S. alba-S. melongena", "E. sativa-P. integrifolia", "B. rapa-S. lycopersicum", "B. oleracea-C. annuum"))
abline(v=50,col="black")
legend(-1,-0.1,legend=c("Recipient","Donor"),bty="n",fill = coul)
text(8.3,6.8,"A) Brassicaceae")
ratio_con <-readRDS("Data/RData/ratio_con.RData")
barplot(ratio_con,hor=T, xlim=c(-1,100),ylim=c(-2,5),width = 0.5,col=coul ,space=0.5,border="white",srt=80,las=1,cex.axis=1,cex.names=1,font=3,names=c("I. purpurea-S. melongena","I. aquatica-C. annuum","I. purpurea-E. sativa","I. aquatica-S. alba"))
abline(v=50,col="black")
legend(-1,-0.5,legend=c("Recipient","Donor"),bty="n",fill = coul)
text(9,3.5,"B) Convolvulaceae")

ratio_sol <-readRDS("Data/RData/ratio_sol.RData")
barplot(ratio_sol,hor=T, xlim=c(-1,100),ylim=c(-2,7),width = 0.5,col=coul ,space=0.5,border="white",srt=80,las=1,cex.axis=1,cex.names=1,font=3,names=c("C. annuum-I. purpurea", "S. melongena-I. aquatica", "P. integrifolia-I. aquatica", "S. lycopersicum-I aquatica","S. melongena-E. sativa", "P. integrifolia-E. sativa", "C. annuum-S. alba", "S. lycopersicum-B. rapa"))
abline(v=50,col="black")
legend(-1,-0.1,legend=c("Recipient","Donor"),bty="n",fill = coul)
text(6.8,6.8,"C) Solanaceae")

```



\clearpage


```{r, echo=FALSE, message=FALSE, warning=FALSE,cache=FALSE,fig.height=6,fig.width=12,  fig.cap="**Fig. S4** Pollen ratios comparisons between the different pollen recipient families where the boxes represent least square means, the error bars, confidence intervals 95%, and sharing numbers indicate no significant differences between groups (Tukey adjusted comparisons). These pollen ratios are the total number of heterospecific pollen grains divided by the total quantity of pollen (conspecific pollen + heterospecific pollen), and then compared by family (N=20)."}


#Here I try to compare the different proportions of pollen between the different groups
#I use Tukey method

library(lme4)
library(emmeans)
library(reshape2)
library(multcompView)
library(lsmeans)
library(multcomp)
library(ggplot2)
library(DHARMa)
setwd("~/R_projects/Hp_pollen_experiment")

total_pollen <- read.csv("Data/Csv/total_pollen.csv")

total_pollen=total_pollen[,-1]
colnames(total_pollen)[3] <- "pollen"
#head(total_pollen)


# Dividing by focal pollen and non focal pollen
# In order to compare pollen as donor and recipient per family 
pollen_foc <- subset(total_pollen, variable=="focal_pollen")
pollen_non <- subset(total_pollen, variable=="non_focal_pollen")

total  <- as.numeric(pollen_foc$pollen) + as.numeric(pollen_non$pollen)
pollen_non$total_pollen  <- total
pollen_non$fam_non <- c(rep("Convolvulaceae", 8), rep("Solanaceae", 6), rep("Brassicaceae", 6))
pollen_non$fam_foc <- c("Solanaceae","Brassicaceae","Brassicaceae","Brassicaceae","Solanaceae",
                        "Solanaceae","Solanaceae","Brassicaceae","Convolvulaceae","Brassicaceae",
                        "Brassicaceae", "Brassicaceae", "Convolvulaceae", "Brassicaceae", "Convolvulaceae", "Solanaceae",
                        "Solanaceae", "Convolvulaceae","Solanaceae","Solanaceae")

pollen_non <- pollen_non[,-c(1,2)]
colnames(pollen_non)[1] <-"hp_pollen"
pollen_non$hp_ratio <- as.numeric(pollen_non$hp_pollen)/as.numeric(pollen_non$total_pollen)
#hist(pollen_non$hp_ratio)

pollen_foc$total_pollen  <- total
pollen_foc$fam_non <- c(rep("Convolvulaceae", 8), rep("Solanaceae", 6), rep("Brassicaceae", 6))
pollen_foc$fam_foc <- c("Solanaceae","Brassicaceae","Brassicaceae","Brassicaceae","Solanaceae",
                        "Solanaceae","Solanaceae","Brassicaceae","Convolvulaceae","Brassicaceae",
                        "Brassicaceae", "Brassicaceae", "Convolvulaceae", "Brassicaceae", "Convolvulaceae", "Solanaceae",
                        "Solanaceae", "Convolvulaceae","Solanaceae","Solanaceae")

pollen_foc <- pollen_foc[,-c(1,2)]
colnames(pollen_foc)[1] <-"hp_pollen"
pollen_foc$hp_ratio <- as.numeric(pollen_foc$hp_pollen)/as.numeric(pollen_foc$total_pollen)
#hist(pollen_foc$hp_ratio)


#Analyse data and plot it

junk.glmer = lm(hp_ratio ~ fam_non, data = pollen_non)
#plot(junk.glmer)
#goodness of fit of the model
#testDispersion(junk.glmer)
#simulationOutput <- simulateResiduals(fittedModel = junk.glmer, plot = T)

#lsm = lsmeans(junk.glmer, "fam_non", type = "response")
#pairs(lsm)
#CLD <- CLD(lsm,alpha=0.05,adjust="tukey")

#ggplot(CLD,aes(x= fam_non,y= lsmean,
#label = .group)) +theme_minimal()+
#geom_point(shape  = 15,size   = 4) +ggtitle("B) Comparison of ratios as donor")+
#geom_errorbar(aes(ymin  =  lower.CL,ymax  =  upper.CL),
#width =  0.2,size =  0.7)+ylab("Least square mean")+xlab("Families")+
#geom_text(nudge_x = c(0, 0, 0), nudge_y = c(0.8, 0.8, 0.8),color   = "black")


#Analyse data and plot it
junk.glmer = lm(hp_ratio ~ fam_foc, data = pollen_foc)
lsm = lsmeans(junk.glmer, "fam_foc", type = "response")
#pairs(lsm)
CLD <- CLD(lsm,alpha=0.05,adjust="tukey")

#theme
theme_ms <- function(base_size=12, base_family="Helvetica") {
  library(grid)
  (theme_bw(base_size = base_size, base_family = base_family)+
      theme(text=element_text(color="black"),
            axis.title=element_text( size = rel(1.3)),
            axis.text=element_text(size = rel(1), color = "black"),
            legend.title=element_text(face="bold"),
            legend.text=element_text(),
            legend.background=element_rect(fill="transparent"),
            legend.key.size = unit(0.8, 'lines'),
            panel.border=element_rect(color="black",size=1),
            panel.grid.minor.x =element_line(),
            panel.grid.minor.y= element_blank()
      ))
}

ggplot(CLD,aes(x= fam_foc,y= lsmean,
               label = .group)) +theme_ms()+
  geom_point(shape  = 15,size   = 4) +ggtitle("")+
  geom_errorbar(aes(ymin  =  lower.CL,ymax  =  upper.CL),
                width =  0.2,size =  0.7)+ylab("Least square mean")+xlab("Families")+ geom_text(nudge_x = c(0, 0, 0), nudge_y = c(0.8, 0.8, 0.8),color   = "black") + theme(axis.text.x = element_text(size=14, face="bold"))


```


\newpage

```{r, echo=FALSE, message=FALSE, warning=FALSE,cache=FALSE,fig.height=12,fig.width=12,  fig.cap="**Fig. S5** Unipartite bidirectional network with asymmetrical effect. The lines with the arrow heads connect the impact of foreign pollen (effect size) of each pollen donor species on each recipient species. All the arrow heads point to the recipient species of the reciprocal interaction. Lines of species that did not have a negative impact are not represented. The different nodes and the donor species appear coloured by family: Solanaceae (orange), Brassicaceae (blue) and Convolvulaceae (green). The intensity of the effect is represented by the line´s size where a larger effect size corresponds to a thicker line and a thinner line to a smaller effect size. Species code: BROL: Brassica oleracea, BRRA: Brassica rapa, ERSA: Eruca sativa, SIAL: Sinapis alba, IPAQ: Ipomoea aquatica, IPPU: Ipomoea purpurea, CAAN: Capsicum annuum, PEIN: Petunia integrifolia, SOLY: Solanum lycopersicum, SOME: Solanum melongena."}
library(statnet)
library(reshape2)
library(sna)
library(igraph)
setwd("~/R_projects/Hp_pollen_experiment")

#######################################
############ Data preparataion ########
#######################################

#In this script I'm going to plot the transitivity of the effect oh HP pollen with effect sizes
effect <- readRDS("Data/RData/matrix_effect_size.RData")
#Now I convert the few values over 0 to maximum 0 (control)
effect[effect>0]<-0
#absolute values so less confusing without negative values
#So now greater values involve greater effect
#(opposite way in comparison with negative values as before)
effect=abs(effect)
#UNIPARTITE DOUBLE ASSYMETRICAL EFFECT
G <- graph.adjacency(t(effect),weighted=TRUE,diag=FALSE)
#plot(G)
E <- t(apply(get.edgelist(G),1,sort))
E(G)$curved <- 0
E(G)[duplicated(E) | duplicated(E,fromLast =TRUE)]$curved <- 0.2
plot(G, edge.width=E(G)$weight/0.5,  vertex.color=c(rep("#0072B2",2),"#D55E00","#0072B2", rep("#009E73",2),
              "#D55E00","#0072B2", rep("#D55E00",2)),edge.arrow.size=0.8,edge.color=adjustcolor(c(rep("#0072B2",8),rep("#0072B2",8), rep("#D55E00",7), 
              rep("#0072B2",9),rep("#009E73",7),rep("#009E73",9),rep("#D55E00",7),rep("#0072B2",8), rep("#D55E00",8), rep("#D55E00",7)), alpha.f = .5))


```


\clearpage


```{r, echo=FALSE, message=FALSE, warning=FALSE,cache=FALSE,fig.height=6,fig.width=6, fig.cap="**Fig S6** Graphical representation of the correlation matrix of the different reproductive traits considered in the experiment. Positive correlations are displayed in blue and negative in red. The intensity, size and colour of the circles are proportional to the correlation coefficient from Pearson’s r."}
#install.packages("corrplot")
library(corrplot)
setwd("~/R_projects/Hp_pollen_experiment")
#Example
#I'm going to try to show our traits on this way
#M <- cor(mtcars)
#corrplot(M, method = "circle")
#We can kill two birds with one stone, showing the correlation and all the traits
traits_all <- read.csv("Data/Csv/traits_all.csv")
si_index <- readRDS("Data/RData/si_index.RData")
traits_all$si_index <- si_index
traits_all=traits_all[,-c(1,2)]
traits_all=traits_all[,-c(1,7,11)]
#Change order of ovary width length I rename below in row and colname
a<-traits_all[,11]
b<-traits_all[,12]
traits_all[,11] <-b
traits_all[,12]<- a
traits_all<- cor(traits_all)

rownames(traits_all)<- c("Selfing rate", "Pollen size", "Pollen per anther", "Number of ovules", "Pollen-ovule ratio",
                         "Stigmatic area", "Stigma length", "Stigma width", "Style length", "Style width",
                         "Ovary length", "Ovary width", "SI index")

colnames(traits_all)<- c("Selfing rate", "Pollen size", "Pollen per anther", "Number of ovules", "Pollen-ovule ratio",
                "Stigmatic area", "Stigma length", "Stigma width", "Style length", "Style width",
                "Ovary length", "Ovary width", "SI index")
  
#corrplot(traits_all, method = "circle")
#corrplot(traits_all, type = "upper")
par(mar=c(0,4.1,4.1,2.1))
corrplot(traits_all, type = "lower", tl.cex = 0.8, cl.cex = 0.8, tl.col = "black", tl.srt = 45)

#Add Compatibility index!

```


\clearpage

```{r, echo=FALSE, message=FALSE, warning=FALSE,cache=FALSE,fig.height=6,fig.width=12,  fig.cap="**Fig. S7** Violin plot of the proportion of seeds coverted to ovule (%) for all species with four different hand-pollination treatments (apomixis, hand cross pollination, hand self pollination and spontaneous selfing). The coloured dots, represent the different values of seed set for each treatment."}

setwd("~/R_projects/Hp_pollen_experiment")

#Script to plot the reproductive biology tests
#load libraries
library(ggplot2)
#install.packages("devtools")
library(devtools)
#install_github("easyGgplot2", "kassambara")
library(effsize)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(cowplot)
library(gridExtra)
library(egg)
library(magrittr)
library(multipanelfigure)
library(grid)

brol <- read.csv("Raw_data/brol_seed_set_final.csv")
brra <- read.csv("Raw_data/brra_seed_set_final.csv")
ersa <- read.csv("Raw_data/ersa_seed_set_final.csv")
sial <- read.csv("Raw_data/sial_seed_set_final.csv")
ipaq <- read.csv("Raw_data/ipaq_seed_set_final.csv")
ippu <- read.csv("Raw_data/ippu_seed_set_final.csv")
caan <- read.csv("Raw_data/caan_seed_set_final.csv")
pein <- read.csv("Raw_data/pein_seed_set_final.csv")
soly <- read.csv("Raw_data/soly_seed_set_final.csv")
some <- read.csv("Raw_data/some_seed_set_final.csv")
#loading traits to divide by number of ovules the seed set 
traits <- read.csv("Data/Csv/traits_scinames.csv")


brol_r <- subset(brol, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="FC")
brol_r$Seed_set <- brol_r$Seed.production/traits[1,8]*100
brra_r <- subset(brra, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="Flower Control")
brra_r$Seed_set <- brra_r$Seed.production/traits[2,8]*100
ersa_r <- subset(ersa, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="Flower Control")
ersa_r$Seed_set <- ersa_r$Seed.production/traits[4,8]*100
sial_r <- subset(sial, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="Flower Control")
sial_r$Seed_set <- sial_r$Seed.production/traits[8,8]*100
ipaq_r <- subset(ipaq, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="Flower control")
ipaq_r$Seed_set <- ipaq_r$Seed.production/traits[5,8]*100
ippu_r <- subset(ippu, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="Flower control")
ippu_r$Seed_set <- ippu_r$Seed.production/traits[6,8]*100
caan_r <- subset(caan, Treatment=="CROSS"|Treatment=="SELF"|Treatment=="CONTROL"|Treatment=="FLOWER CONTROL")
caan_r$Seed_set <- caan_r$Seed.production/traits[3,8]*100
pein_r <- subset(pein, Treatment=="CROSS"|Treatment=="SELF"|Treatment=="CONTROL"|Treatment=="FLOWER CONTROL")
pein_r$Seed_set <- pein_r$Seed.production/traits[7,8]*100
soly_r <- subset(soly, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="Flower control")
soly_r$Seed_set <- soly_r$Seed.production/traits[9,8]*100
some_r <- subset(some, Treatment=="Cross"|Treatment=="Self"|Treatment=="Control"|Treatment=="Flower control")
some_r$Seed_set <- some_r$Seed.production/traits[10,8]*100

d <- rbind(brol_r,brra_r,ersa_r,sial_r,ipaq_r,ippu_r,caan_r,pein_r,soly_r,some_r)
d$Seed_set[d$Seed_set>100]<-100

#levels(d$Treatment)
d$Treatment=as.character(d$Treatment)
d$Treatment[d$Treatment=="Cross"]<-"Hand cross-pollination"
d$Treatment[d$Treatment=="CROSS"]<-"Hand cross-pollination"
d$Treatment[d$Treatment=="Self"]<-"Hand self-pollination"
d$Treatment[d$Treatment=="SELF"]<-"Hand self-pollination"
d$Treatment[d$Treatment=="SELF"]<-"Hand self-pollination"
d$Treatment[d$Treatment=="Control"]<-"Apomixis"
d$Treatment[d$Treatment=="CONTROL"]<-"Apomixis"
d$Treatment[d$Treatment=="FC"]<-"Spontaneous selfing"
d$Treatment[d$Treatment=="Flower control"]<-"Spontaneous selfing"
d$Treatment[d$Treatment=="FLOWER CONTROL"]<-"Spontaneous selfing"
d$Treatment[d$Treatment=="Flower Control"]<-"Spontaneous selfing"

d$Species=as.character(d$Species)
d$Species[d$Family=="BROL"]<-"B"
d$Species[d$Family=="BRRA"]<-"B"
d$Species[d$Family=="ERSA"]<-"B"
d$Species[d$Family=="SIAL"]<-"B"
d$Species[d$Family=="IPPU"]<-"C"
d$Species[d$Family=="IPAQ"]<-"C"
d$Species[d$Family=="SOME"]<-"S"
d$Species[d$Family=="SOLY"]<-"S"
d$Species[d$Family=="PEIN"]<-"S"
d$Species[d$Family=="CAAN"]<-"S"

d$Species[d$Species=="BROL"]<-"B. oleracea"
d$Species[d$Species=="BRRA"]<-"B. rapa"
d$Species[d$Species=="SIAL"]<-"S. alba"
d$Species[d$Species=="ERSA"]<-"E. sativa"
d$Species[d$Species=="IPPU"]<-"I. purpurea"
d$Species[d$Species=="IPAQ"]<-"I. aquatica"
d$Species[d$Species=="SOLY"]<-"S. lycopersicum"
d$Species[d$Species=="SOME"]<-"S. melongena"
d$Species[d$Species=="PEIN"]<-"P. integrifolia"
d$Species[d$Species=="CAAN"]<-"C. annuum"

cbPalette <- c( "#56B4E9","#E69F00", "#999999", "#009E73")

 ggplot(d, aes(x=Species, y=Seed_set, fill=Treatment)) + 
  geom_violin(scale = "width",draw_quantiles = c(0.5))+
  geom_dotplot(binaxis='y', 
               dotsize=0.15,stackdir='center',position = position_jitterdodge(jitter.width = 0.01))+
  theme_minimal()+labs(y="Seed:ovule ratio")+scale_fill_manual(values=c( "#D55E00","#009E73","#0072B2", "#E69F00"))+theme(legend.title = element_blank(),plot.title = element_text(face = "bold"),axis.text.x = element_text(face = "italic"))

```

\newpage


```{r, echo=FALSE, message=FALSE, warning=FALSE,cache=FALSE,fig.height=9,fig.width=7, fig.cap="**Fig. S8** Effect sizes (95% confidence intervals) of the different families on each focal species (recipient) and a hand cross-pollination treatment (control). For each species the control treatment appears in yellow and the grouped effect per family in blue for Brassicaceae, green for Convolvulaceae and orange for Solanaceae."}

library(effsize)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(cowplot)
library(gridExtra)
library(egg)
library(magrittr)
library(multipanelfigure)
library(grid)

setwd("~/R_projects/Hp_pollen_experiment")
load("Data/RData/some_effect_size_family.RData")

pp1<- ggplot(some_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")



load("Data/RData/soly_effect_size_family.RData")

pp2<- ggplot(soly_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")


load("Data/RData/sial_effect_size_family.RData")

p3<- ggplot(sial_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")


load("Data/RData/pein_effect_size_family.RData")

p4<- ggplot(pein_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")


load("Data/RData/ippu_effect_size_family.RData")

p5<- ggplot(ippu_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")

load("Data/RData/ipaq_effect_size_family.RData")

p6<- ggplot(ipaq_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")

load("Data/RData/ersa_effect_size_family.RData")

p7<- ggplot(ersa_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")

load("Data/RData/caan_effect_size_family.RData")

p8<- ggplot(caan_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")

load("Data/RData/brra_effect_size_family.RData")

p9<- ggplot(brra_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")


load("Data/RData/brol_effect_size_family.RData")

p10<- ggplot(brol_effect_size, aes(Family,Cohen_d, size=10)) + theme_bw(base_size=10)+ geom_point(size=2,show.legend = FALSE,aes(color=factor(Family))) +
  geom_linerange(size=0.6,shape=3,linetype=1,show.legend=FALSE, aes(x = Family, ymin = Lower, 
ymax = Upper,color=factor(Family)))+
  scale_color_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  scale_fill_manual("Family",values=c("#E69F00", "#0072B2", "#009E73", "#D55E00"))+
  xlab("") + ylab("Cohen's d") + rotate(ylim = c(-6, 2))+guides(fill=FALSE)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")

 #grid.arrange(p1, p5, p3, p4, nrow=2,ncol=2,top="Solanaceae")
grid.newpage()
 grid.draw(arrangeGrob(cbind(ggplotGrob(pp1),ggplotGrob(pp2), size="last"),cbind(ggplotGrob(p3),ggplotGrob(p4),size="last"),cbind(ggplotGrob(p5),ggplotGrob(p6), size="last"),cbind(ggplotGrob(p7),ggplotGrob(p8), size="last"),cbind(ggplotGrob(p9),ggplotGrob(p10), size="last"),nrow=5))
```




